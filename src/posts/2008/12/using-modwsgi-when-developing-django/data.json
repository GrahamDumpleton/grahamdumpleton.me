{
  "title": "Using mod_wsgi when developing Django sites.",
  "content": "If one were to ask on the Django forums or irc channels what server to use when developing a Django site, the advice generally given is to use Django's own internal development server and to only deploy it under [mod\\_wsgi](http://www.modwsgi.org/) or another hosting mechanism when moving it into production. One of the main reasons given for doing this is that Django's development server will detect when you make code changes and automatically restart the Django process.\n\n  \n\n\nWhat seems to be not well known though is that mod\\_wsgi can also be setup to automatically restart the Django processes. Yes, some know about the ability when using mod\\_wsgi daemon mode to touch the WSGI script file and have the Django process restarted, but what I am talking about here is a completely automated system which will detect changes to any Python code files and restart the Django process, just like with the Django development server, and not just when a change is made to the WSGI script file. This automated system completely avoids the need to manually touch the WSGI script file after you have made any changes.\n\n  \n\n\nHow this can be achieved is described in section 'Restarting Daemon Processes' of the mod\\_wsgi documentation about [source code reloading](http://code.google.com/p/modwsgi/wiki/ReloadingSourceCode#Restarting_Daemon_Processes). What I will do here though is summarise how that code recipe can be applied to a Django site.\n\n  \n\n\nActual setup instructions for using Django with mod\\_wsgi are described in the [Django integration guide](http://code.google.com/p/modwsgi/wiki/IntegrationWithDjango) on the mod\\_wsgi site. Although they contain the important information you need, it is still best to have also read the [quick configuration guide](http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide) and [configuration guidelines](http://code.google.com/p/modwsgi/wiki/ConfigurationGuidelines). \n\n  \n\n\nThe example configuration give in the Django integration guide for using daemon mode is:\n    \n    \n    WSGIDaemonProcess site-1 user=user-1 group=user-1 threads=25  \n    WSGIProcessGroup site-1  \n      \n    Alias /media/ /usr/local/django/mysite/media/  \n      \n    <Directory /usr/local/django/mysite/media>  \n    Order deny,allow  \n    Allow from all  \n    </Directory>  \n      \n    WSGIScriptAlias / /usr/local/django/mysite/apache/django.wsgi  \n      \n    <Directory /usr/local/django/mysite/apache>  \n    Order deny,allow  \n    Allow from all  \n    </Directory>  \n    \n\nThe corresponding example WSGI script file is:\n    \n    \n    import os, sys  \n    sys.path.append('/usr/local/django')  \n    os.environ['DJANGO_SETTINGS_MODULE'] = 'mysite.settings'  \n      \n    import django.core.handlers.wsgi  \n      \n    application = django.core.handlers.wsgi.WSGIHandler()  \n    \n\nIt is this latter WSGI script file to which we need to make an addition. Rather than make all the changes to this file though, we will add a new Python code file into the Django site directory and put the bulk of the code in it.\n\n  \n\n\nSo, in the same directory as where the 'settings.py' file is for your Django site, add a file called 'monitor.py'. In this file place the code recipe for implementing an automatic restart mechanism from the mod\\_wsgi documentation on [reloading source code](http://code.google.com/p/modwsgi/wiki/ReloadingSourceCode#Restarting_Daemon_Processes). Then go back to the WSGI script file and at the end of the file add:\n    \n    \n    import mysite.monitor  \n    mysite.monitor.start(interval=1.0)  \n    \n\nObviously, the name of your site being different, you should substitute 'mysite' with the actual name of your site. Anyway, that is all that is required.\n\n  \n\n\nWhat will now happen is that when the WSGI script file is loaded, it will initialise the code which will monitor changes to any code files. This will have the side affect of creating a background thread which will periodically scan through all the loaded Python modules and try to determine if the corresponding file on disk has been changed since the last scan. If a change is detected, then the thread will signal the process that it needs to be shutdown. When shutdown is complete, mod\\_wsgi will detect this and startup a new process in its place. Upon a subsequent request for your Django site, the WSGI script file is loaded once more and we start over.\n\n  \n\n\nNow, why develop your Django site using mod\\_wsgi? There are a few reasons.\n\n  \n\n\nThe first is that if mod\\_wsgi is going to be your production target anyway, you are guaranteed from the start that you will have an equivalent environment and not be hit with problems often seen whereby code works with the development server but not under mod\\_wsgi. Using mod\\_wsgi you will know about these issues sooner and be able to ensure mod\\_wsgi and your environment is configured correctly.\n\n  \n\n\nThe second is that the Django development server is only single threaded. As a result, it isn't really a suitable test bed for ensuring your code is multithread safe through the whole development process.\n\n  \n\n\nA third is that Django development server is a single process web server. If using mod\\_wsgi it is quite likely you would deploy with a configuration which makes use of multiple process to handle requests. One cannot simulate this type of setup easily with the development server.\n\n  \n\n\nFinally, with mod\\_wsgi the setup would be close to if not the same as your deployment configuration. This means that you could do realistic tests of how well your application will perform all through the development process through running suitable benchmarks. This would allow you to identify much earlier any performance bottlenecks without having to go through a process of first having to install on a separate staging environment.\n\n  \n\n\nJust remember though when you do go to release to your production environment, or even just enable the development instance as the live site, that you disable the code monitor. The overhead may not be noticeable in the grand scheme of things, but better to avoid having processes restart when you least expect them to.\n\n  \n\n\nBTW, mod\\_wsgi daemon mode requires Apache 2.X on UNIX. The feature is not available on Apache 1.3 or Windows.",
  "date": "2008-12-19",
  "author": "Graham Dumpleton",
  "url": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html",
  "post_id": "1212814783947719250",
  "blog_id": "2363643920942057324",
  "comments": [
    {
      "comment_id": "632071591784009359",
      "author": "Waldemar",
      "author_url": "https://www.blogger.com/profile/07263420595928767200",
      "author_profile_id": "07263420595928767200",
      "content": "any chance the functionality will be available on Windows one day?",
      "timestamp": "December 20, 2008 at 2:00 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1229742000000#c632071591784009359",
      "is_blog_author": false
    },
    {
      "comment_id": "3643216305680379345",
      "author": "Graham Dumpleton",
      "author_url": "https://www.blogger.com/profile/13609779138164842374",
      "author_profile_id": "13609779138164842374",
      "content": "Windows doesn't support forking of processes and so cannot support daemon mode as it is currently implemented in mod\\_wsgi. You will therefore not see that feature.  \n  \nAs for the automated restarts when code changes are detected, there is an outside chance that this could be made to work now even though embedded mode is all that is supported.  \n  \nThis is because on Windows there is only one process handling requests, and so having it signal the parent monitor process to trigger a restart is probably reasonably safe.  \n  \nWhat might thus be able to be done is to use Python ctypes module to call the Apache function ap\\_signal\\_parent\\(\\). The argument to this function should be enumeration value SIGNAL\\_PARENT\\_RESTART. If assigning of enumerated values follows what one would normally expect, this would be a integer value of 1.  \n  \nI am not a Windows person, but if you want to explore whether that can be done or not, post a message to mod\\_wsgi mailing list on Google groups and can discuss it there.",
      "timestamp": "December 20, 2008 at 3:11 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1229746260000#c3643216305680379345",
      "is_blog_author": true
    },
    {
      "comment_id": "4973964042254437524",
      "author": null,
      "author_url": null,
      "author_profile_id": null,
      "content": "I've never once used the Django dev server for local development. Previously it was apache and mod\\_python, and now we all use mod\\_wsgi. I simply set the max child processes value to 1 so the process constantly dies. I haven't noticed any performance issues locally with this method, my local server is fast as a bat out of hell... even when some of our dev code isn't exactly the fastest :P Any real reason to move away from this and have the process detect code changes and restart when only necessary?",
      "timestamp": "December 26, 2008 at 1:38 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1230259080000#c4973964042254437524",
      "is_blog_author": false
    },
    {
      "comment_id": "6299982903233226260",
      "author": "Graham Dumpleton",
      "author_url": "https://www.blogger.com/profile/13609779138164842374",
      "author_profile_id": "13609779138164842374",
      "content": "Using MaxRequestsPerChild or maximum-requests, if using mod\\_wsgi daemon mode, set to a value of 1 will only serve to slow things down. If you are the only user and requests are infrequent, so long as your application doesn't have large startup costs can still be okay, but seems a bit wasteful.",
      "timestamp": "December 26, 2008 at 2:55 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1230263700000#c6299982903233226260",
      "is_blog_author": true
    },
    {
      "comment_id": "4977720601072857149",
      "author": null,
      "author_url": null,
      "author_profile_id": null,
      "content": "While on the subject of mod\\_wsgi and Django, it seems that the following page needs to be updated \\(towards the end in the paragraphs that involve threading issues\\):  \n  \nhttp://code.google.com/p/modwsgi/wiki/IntegrationWithDjango  \n  \nThe link provided on that page regarding the threading issues seems to imply that threading is confirmed to work in Django 1.0 and up; the paragraphs surrounding the link, however, seem to be about Django releases prior to 1.0.  \n  \nApologies if this is an inappropriate place to mention this, but I was not sure where was best to contact you.  \n  \nAlso, thank you for the good article.",
      "timestamp": "February 10, 2009 at 1:47 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1234234020000#c4977720601072857149",
      "is_blog_author": false
    },
    {
      "comment_id": "922318956698263231",
      "author": "Graham Dumpleton",
      "author_url": "https://www.blogger.com/profile/13609779138164842374",
      "author_profile_id": "13609779138164842374",
      "content": "The referenced page about Django threading issues is a Django user contributed page and does not represent an official statement from the core Django developers. The core Django documentation still recommends use of prefork MPM for Apache and mod\\_python, that is, single threaded environment. Until the core Django developers change their recommendation and make a clear statement that Django 1.0+ is thread safe, I'll probably continue to give more emphasis to the warnings that there may be threading issues.",
      "timestamp": "February 10, 2009 at 2:39 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1234237140000#c922318956698263231",
      "is_blog_author": true
    },
    {
      "comment_id": "2794897967352519264",
      "author": "Graham Dumpleton",
      "author_url": "https://www.blogger.com/profile/13609779138164842374",
      "author_profile_id": "13609779138164842374",
      "content": "See [/posts/2009/02/source-code-reloading-with-modwsgi-on/](/posts/2009/02/source-code-reloading-with-modwsgi-on/) for how to adapt this to Windows.",
      "timestamp": "February 26, 2009 at 10:18 AM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1235603880000#c2794897967352519264",
      "is_blog_author": true
    },
    {
      "comment_id": "241299513703539325",
      "author": "Unknown",
      "author_url": "https://www.blogger.com/profile/07796580014198531832",
      "author_profile_id": "07796580014198531832",
      "content": "Hey Graham  \n  \nThank you for pointing me to this wonderful post of yours \\(It works like my fingers on the keyboard\\! hehe\\)  \n  \nNow I am having a problem with the trailing slashes, what to I need to do in order for http://localhost/upload to be http://localhost/upload/ since my settings.py file has APPEND\\_SLASH = True but when I visit http://localhost/upload I am greeted with an **internal server error**  \nCheers and thanks again.",
      "timestamp": "June 22, 2009 at 8:52 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1245667932427#c241299513703539325",
      "is_blog_author": false
    },
    {
      "comment_id": "5449043536802819399",
      "author": "Graham Dumpleton",
      "author_url": "https://www.blogger.com/profile/13609779138164842374",
      "author_profile_id": "13609779138164842374",
      "content": "@Josie: You are better off taking your upload issue to django-users list on Google Groups. You will possibly need to provide a bit more detail than that, such as how you are setting up route for upload directory in urls.py etc.",
      "timestamp": "June 22, 2009 at 9:32 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1245670369331#c5449043536802819399",
      "is_blog_author": true
    },
    {
      "comment_id": "1444791448972745825",
      "author": "rocketmonkeys",
      "author_url": "https://www.blogger.com/profile/10620188455142530229",
      "author_profile_id": "10620188455142530229",
      "content": "Hey graham, thanks so much for posting the code\\! I've modified it to use it on windows, works great.  \n  \nhttp://www.rocketmonkeys.com/post.364  \n  \nMakes things so much nicer to develop in windows when using apache instead of the 'manage.py runserver'. Thanks again.",
      "timestamp": "November 12, 2009 at 8:05 AM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1257973558728#c1444791448972745825",
      "is_blog_author": false
    },
    {
      "comment_id": "4210945819178495078",
      "author": "Graham Dumpleton",
      "author_url": "https://www.blogger.com/profile/13609779138164842374",
      "author_profile_id": "13609779138164842374",
      "content": "rocketmonkeys: Why did you modify it how you did.?The separate post at [/posts/2009/02/source-code-reloading-with-modwsgi-on/](/posts/2009/02/source-code-reloading-with-modwsgi-on/) and the documentation on mod\\_wsgi site at http://code.google.com/p/modwsgi/wiki/ReloadingSourceCode already explain better way of doing it for Windows.",
      "timestamp": "November 12, 2009 at 8:13 AM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1257973986485#c4210945819178495078",
      "is_blog_author": true
    },
    {
      "comment_id": "5611109296953653140",
      "author": "GamesBook",
      "author_url": "https://www.blogger.com/profile/08822273243607808813",
      "author_profile_id": "08822273243607808813",
      "content": "You say that \"the core Django documentation still recommends use of prefork MPM for Apache and mod\\_python\"  \n  \nBut on this page:  \nhttp://docs.djangoproject.com/en/1.0/howto/deployment/  \n\\(which AFAIK is an official Django doc\\) it reads:  \n  \n\"If you’re new to deploying Django and/or Python, we’d recommend you try mod\\_wsgi first. In most cases it’ll be the easiest, fastest, and most stable deployment choice.\"",
      "timestamp": "March 3, 2010 at 6:20 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1267600841319#c5611109296953653140",
      "is_blog_author": false
    },
    {
      "comment_id": "4498570490346806399",
      "author": "Graham Dumpleton",
      "author_url": "https://www.blogger.com/profile/13609779138164842374",
      "author_profile_id": "13609779138164842374",
      "content": "GamesBook, this blog post was made over a year ago. At that time the Django documentation still recommended mod\\_python.",
      "timestamp": "March 3, 2010 at 8:12 PM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1267607566367#c4498570490346806399",
      "is_blog_author": true
    },
    {
      "comment_id": "7874901913909708077",
      "author": "Unknown",
      "author_url": "https://www.blogger.com/profile/17842839138071256208",
      "author_profile_id": "17842839138071256208",
      "content": "Thanks, this is a life saver",
      "timestamp": "December 31, 2010 at 9:01 AM",
      "permalink": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html?showComment=1293746461122#c7874901913909708077",
      "is_blog_author": false
    }
  ],
  "labels": [
    "django",
    "mod_wsgi"
  ],
  "metadata": {
    "published_timestamp": "2008-12-19T21:24:00+11:00",
    "blog_title": "Graham Dumpleton",
    "page_title": "Graham Dumpleton: Using mod_wsgi when developing Django sites.",
    "og_title": "Using mod_wsgi when developing Django sites.",
    "og_description": "If one were to ask on the Django forums or irc channels what server to use when developing a Django site, the advice generally given is to u...",
    "og_url": "http://blog.dscpl.com.au/2008/12/using-modwsgi-when-developing-django.html"
  },
  "downloaded_images": []
}