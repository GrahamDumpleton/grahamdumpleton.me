<!DOCTYPE html>
<html class='v2' dir='ltr' lang='en'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/2508126174-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='http://blog.dscpl.com.au/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Graham Dumpleton - Atom" href="http://blog.dscpl.com.au/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Graham Dumpleton - RSS" href="http://blog.dscpl.com.au/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Graham Dumpleton - Atom" href="https://www.blogger.com/feeds/2363643920942057324/posts/default" />

<link rel="alternate" type="application/atom+xml" title="Graham Dumpleton - Atom" href="http://blog.dscpl.com.au/feeds/3019441481164740419/comments/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<meta content='http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html' property='og:url'/>
<meta content='Testing a wsgi.file_wrapper implementation.' property='og:title'/>
<meta content='Not many WSGI servers or gateways have attempted to provide an implementation of the wsgi.file_wrapper extension. Of those, some provide the...' property='og:description'/>
<title>Graham Dumpleton: Testing a wsgi.file_wrapper implementation.</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */
/* Content
----------------------------------------------- */
body {
font: normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #222222;
background: #66bbdd none repeat scroll top left;
padding: 0 40px 40px 40px;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2187bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #32aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 40px rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 5px rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 10px #333333;
box-shadow: 0 0 40px rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 10px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #3299bb;
text-shadow: -1px -1px 1px rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #3299bb;
}
.Header .description {
font-size: 140%;
color: #777777;
}
.header-inner .Header .titlewrapper {
padding: 22px 30px;
}
.header-inner .Header .descriptionwrapper {
padding: 0 30px;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 1px solid #eeeeee;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #eeeeee;
border-left: 0 solid #eeeeee;
border-right: 0 solid #eeeeee;
}
.tabs-inner .widget ul {
background: #f5f5f5 url(https://resources.blogblog.com/blogblog/data/1kt/simple/gradients_light.png) repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #eeeeee;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #999999;
border-left: 1px solid #ffffff;
border-right: 1px solid #eeeeee;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid #eeeeee;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid #eeeeee;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid #eeeeee;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: transparent;
color: #222222;
padding: inherit;
letter-spacing: inherit;
margin: inherit;
}
.main-inner {
padding-top: 30px;
padding-bottom: 30px;
}
.main-inner .column-center-inner {
padding: 0 15px;
}
.main-inner .column-center-inner .section {
margin: 0 15px;
}
.post {
margin: 0 0 25px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #222222;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #f9f9f9;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid #eeeeee;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #eeeeee;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #f9f9f9;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid #eeeeee;
}
.blog-pager {
background: transparent none no-repeat scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 0 dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #222222;
}
.mobile-link-button {
background-color: #2187bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #eeeeee;
border-bottom: 1px solid #eeeeee;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #eeeeee;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1020px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1020px;
max-width: 1020px;
_width: 1020px;
}
.main-inner .columns {
padding-left: 0px;
padding-right: 200px;
}
.main-inner .fauxcolumn-center-outer {
left: 0px;
right: 200px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0px") -
parseInt("200px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0px;
}
.main-inner .fauxcolumn-right-outer {
width: 200px;
}
.main-inner .column-left-outer {
width: 0px;
right: 100%;
margin-left: -0px;
}
.main-inner .column-right-outer {
width: 200px;
margin-right: -200px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2363643920942057324&amp;zx=8e425bf4-e933-49a5-a874-6a5d9cccad39' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2363643920942057324&amp;zx=8e425bf4-e933-49a5-a874-6a5d9cccad39' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

<!-- data-ad-client=ca-pub-6433235630058377 -->

</head>
<body class='loading variant-pale'>
<div class='navbar section' id='navbar' name='Navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar/2363643920942057324?po\x3d3019441481164740419\x26origin\x3dhttp://blog.dscpl.com.au',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='http://blog.dscpl.com.au/'>
Graham Dumpleton
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>
</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol' name='Cross-Column'></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Saturday, January 22, 2011</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='2363643920942057324' itemprop='blogId'/>
<meta content='3019441481164740419' itemprop='postId'/>
<a name='3019441481164740419'></a>
<h3 class='post-title entry-title' itemprop='name'>
Testing a wsgi.file_wrapper implementation.
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-3019441481164740419' itemprop='description articleBody'>
Not many WSGI servers or gateways have attempted to provide an implementation of the wsgi.file_wrapper extension. Of those, some provide the callable for generating the file wrapper, but then do not go on to implement any high performance optimisation. Part of the reason for this is that the Python standard library does not expose the UNIX sendfile() function. As such, a full implementation of wsgi.file_wrapper is usually restricted to WSGI server or gateway implementations implemented directly in C code.<br /><br />Despite the UNIX sendfile() call not being present in the Python standard library, it still is possible in a pure Python WSGI server or gateway to fully implement wsgi.file_wrapper with optimisations. This can be done by using the &#8216;ctypes&#8217; module to access and call the underlying UNIX sendfile() function. I will explain how to do that in a subsequent blog post, but before doing that I am going to describe a series of tests which can be used to validate the operation of a wsgi.file_wrapper implementation.<br /><br />The first series of tests check aspects of wsgi.file_wrapper which would potentially be exercised under normal use. The remainder of the tests try and break implementations by doing unexpected things.<br /><br />The tests can be used to validate an existing WSGI server or gateway that provides an implementation. They are also a good indicator of what needs to be taken into consideration when actually implementing wsgi.file_wrapper and which is why I am presenting them before an actual implementation.<br /><br />Note that the tests assume that wsgi.file_wrapper exists and the code doesn&#8217;t supply its own alternative if it doesn&#8217;t. Thus if your WSGI server or gateway does not implement wsgi.file_wrapper at all, the tests will fail in the lookup of wsgi.file_wrapper in the first place.<br /><br /><b>File Objects</b><br /><br />The standard use case is to open a file, wrap it using wsgi.file_wrapper and return it.<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br /><br />    response_headers = [('Content-type', 'text/plain')]<br />    start_response(status, response_headers)<br /><br />    filelike = file('/tmp/filetest.txt', 'w')<br />    filelike.write(string.ascii_lowercase)<br />    filelike.close()<br /><br />    filelike = file('/tmp/filetest.txt', 'r')<br /><br />    return environ['wsgi.file_wrapper'](filelike)</pre>In this case we have not supplied a Content-Length response header. As such, the expectation would be that the complete file should be returned.<br /><br />The WSGI specification given in PEP 333 doesn&#8217;t make any mention about whether a WSGI server or gateway need add a Content-Length if none is supplied, however the revised PEP 3333 does, stating:<br /><br />"""If the application doesn't supply a Content-Length, the server may generate one from the file using its knowledge of the underlying file implementation."""<br /><br />Best practice would be that the Content-Length header is added, especially in the case that sendfile() is used to send the file in one big chunk. This is because there isn&#8217;t going to be an opportunity to apply HTTP/1.1 chunked encoding on the response content.<br /><br />If an implementation isn&#8217;t attempting to use sendfile(), but instead is writing the data itself in chunks, then it could if the client protocol was HTTP/1.1, choose to use chunked transfer encoding rather than setting the Content-Length response header. As the content length can be readily calculated though, it would generally be simpler just to set the response header and send the content as is.<br /><br />Do note though that if the WSGI server or gateway is setting the Content-Length response header, then it should ensure that it only sends that amount of data. This would be important where the file to be sent is being appended to, eg., a log file. In other words, once the WSGI server or gateway indicates it will send a certain amount of data, it shouldn&#8217;t then just stream till the end of file in case the size of the file has since changed.<br /><br /><b>File Like Objects</b><br /><br />Using a standard Python file object would be the typical use case, but any file like object can technically be used. For this PEP 3333 says:<br /><br />"""Note that even if the object is not suitable for the platform API, the wsgi.file_wrapper must still return an iterable that wraps read() and close(), so that applications using file wrappers are portable across platforms."""<br /><br />This actually applies in two ways. The first is if the platform itself doesn&#8217;t provide a way of dealing with a file object in a performant way, or if a file like object doesn&#8217;t provide the attributes which would allow a specific mechanism to be used.<br /><br />The Windows operating system is an example of the first, whereby the sendfile() call is not available. An example of the latter is where rather than a file object being supplied a file like object such as a StringIO object is supplied.<br /><br />On a UNIX system where an implementation is using sendfile(), the fallback can therefore be tested using an instance of StringIO.<pre>import StringIO<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br /><br />    response_headers = [('Content-type', 'text/plain')]<br />    start_response(status, response_headers)<br /><br />    filelike = StringIO.StringIO(string.ascii_lowercase)<br /><br />    return environ['wsgi.file_wrapper'](filelike)</pre>Either way, the content accessible should still be written back to the client and the wsgi.file_wrapper implementation should not fail.<br /><br />Using StringIO in particular is a good test because it does not provide a fileno() method and if an implementation blindly assumes that a object will always be provided that has a fileno() method it will fail. For the case where the implementation is written in C and the PyObject_AsFileDescriptor() function is used to get the file descriptor the implementation needs to validate that &#8216;-1&#8217; is not returned and fallback to processing the iterable instead. If this isn&#8217;t done, then the implementation may try and access an invalid file descriptor.<br /><br />For this specific case, we again haven&#8217;t supplied a Content-Length and it wouldn&#8217;t necessarily be possible to deduce it. As such, if the client protocol was HTTP/1.1, then chunked transfer encoding might be used if the HTTP/WSGI server supports it.<br /><br /><b>Content Length</b><br /><br />No matter what type of file like object is used, be it an actual file object or otherwise, a WSGI application can optionally set a Content-Length response header itself. This header is meant to be the authoritative indicator as to how much response data is to be returned.<br /><br />If the Content-Length header is supplied and the value it is given equates to the actual amount of content then there is no problem. If however the given content length is less than the actual amount of data accessible via the file like object, then only that amount of data should be returned and no more.<br /><br />The WSGI specification as outlined in PEP 333 is actually wrong in this respect in that it says:<br /><br />"""Apart from the handling of close(), the semantics of returning a file wrapper from the application should be the same as if the application had returned iter(filelike.read, ''). In other words, transmission should begin at the current position within the "file" at the time that transmission begins, and continue until the end is reached."""<br /><br />In other words, it doesn&#8217;t indicate that the Content-Length header should be taken into consideration. PEP 3333 corrects this and states:<br /><br />"""Apart from the handling of close(), the semantics of returning a file wrapper from the application should be the same as if the application had returned iter(filelike.read, ''). In other words, transmission should begin at the current position within the "file" at the time that transmission begins, and continue until the end is reached, or until Content-Length bytes have been written."""<br /><br />This scenario needs to be tested and for both a file object and the fallback case for any file like object. Thus would want to perform the test:<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br /><br />    response_headers = [('Content-type', 'text/plain'),<br />                        ('Content-length', str(len(string.ascii_lowercase)/2))]<br />    start_response(status, response_headers)<br /><br />    filelike = file('/tmp/filetest.txt', 'w+')<br />    filelike.write(string.ascii_lowercase)<br />    filelike.close()<br /><br />    filelike = file('/tmp/filetest.txt', 'r')<br /><br />    return environ['wsgi.file_wrapper'](filelike)</pre>and:<pre>import StringIO<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br /><br />    response_headers = [('Content-type', 'text/plain'),<br />                        ('Content-length', str(len(string.ascii_lowercase)/2))]<br />    start_response(status, response_headers)<br /><br />    filelike = StringIO.StringIO(string.ascii_lowercase)<br /><br />    return environ['wsgi.file_wrapper'](filelike)</pre>Note that one can&#8217;t rely on using a web browser to validate the output in these cases. This is because a web browser will normally not display any additional data that has been sent beyond what the Content-Length indicated should exist. It is therefore necessary to use a network snooping tool or even telnet directly to the HTTP server port and enter the request and view the raw details of the HTTP response.<pre>$ telnet localhost 8000<br />Trying 127.0.0.1...<br />Connected to localhost.<br />Escape character is '^]'.<br />GET / HTTP/1.0<br /><br />HTTP/1.1 200 OK<br />Content-type: text/plain<br />Content-length: 13<br /><br />abcdefghijklmnopqrstuvwxyzConnection closed by foreign host.</pre>A valid implementation should only return the amount of data specified by the Content-Length header and no more, thus not what the above output shows.<br /><br /><b>Current Position</b><br /><br />One of the sections previously quoted from PEP 3333 states:<br /><br />"""Apart from the handling of close(), the semantics of returning a file wrapper from the application should be the same as if the application had returned iter(filelike.read, ''). In other words, transmission should begin at the current position within the "file" at the time that transmission begins, and continue until the end is reached, or until Content-Length bytes have been written."""<br /><br />Key to note here is the phrase &#8216;transmission should begin at the current position within the "file"&#8217;.<br /><br />Normally when a file is opened the current seek position or file pointer will be at the start of the file. This means that where no Content-Length is specified the complete contents of the file would be returned. If however the current position within the file was not at the start of the file, then the complete file should not be returned and instead only from the current position up to the end of the file, or if Content-Length is specified, only that many bytes from the the current position should be returned.<br /><br />Tests which validate the correct behaviour for these situations are:<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK' <br />    <br />    response_headers = [('Content-type', 'text/plain')]<br />    start_response(status, response_headers)<br />    <br />    filelike = file('/tmp/filetest.txt', 'w+')<br />    filelike.write(string.ascii_lowercase)<br />    filelike.flush()<br />    <br />    filelike.seek(len(string.ascii_lowercase)/2, os.SEEK_SET)<br /><br />    return environ['wsgi.file_wrapper'](filelike)</pre>and:<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK' <br />    <br />    response_headers = [('Content-type', 'text/plain'),<br />                        ('Content-length', str(len(string.ascii_lowercase)/4))]<br />    start_response(status, response_headers)<br />    <br />    filelike = file('/tmp/filetest.txt', 'w+')<br />    filelike.write(string.ascii_lowercase)<br />    filelike.flush()<br />    <br />    filelike.seek(len(string.ascii_lowercase)/2, os.SEEK_SET)<br /><br />    return environ['wsgi.file_wrapper'](filelike)</pre>For the first test, from the middle of the file to the end of the file should be returned and if the Content-Length header is set automatically, should correctly reflect that reduced length. The second test should again start from the middle of the file, but should only return 6 characters from the 3rd section of the file.<br /><br />As with the prior test setting Content-Length, you can&#8217;t rely on the browser for the latter test as it will only show as much data as indicated by Content-Length even if more data had actually be returned. A check should therefore be made of the raw HTTP response.<br /><br />There is no strict need to perform this test where a file like object such as StringIO is used as the way data is consumed in that case means that reading can only start from the current position. An actual file object is different because the optimisation to return the file contents would usually work directly with the file descriptor and not via any high level interface.<br /><br /><b>Multiple Instances</b><br /><br />Now it is time to try and start breaking the wsgi.file_wrapper implementation by doing abnormal things. Granted that these things wouldn&#8217;t normally be done, but by testing them it tests the robustness of the implementation of wsgi.file_wrapper. If an implementation takes short cuts or uses a bad design, then it could result in incorrect behaviour, or in worst case for a C based implementation, cause the process to crash.<br /><br />The first test that can be done is to use wsgi.file_wrapper multiple times within the context of the same request. Obviously only the result of one invocation of wsgi.file_wrapper can actually be returned by the WSGI application. This need not even be the result of the last call. No matter which is returned, the original file used with that which is returned should be what is written back to the HTTP client.<br /><br />We therefore first check for case where last instance of wsgi.file_wrapper created is returned.<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br />    <br />    response_headers = [('Content-type', 'text/plain'),]<br />    start_response(status, response_headers)<br />    <br />    filelike1 = file('/tmp/filetest-a.txt', 'w+')<br />    filelike1.write(string.ascii_lowercase)<br />    filelike1.flush()<br />    filelike1.seek(0, os.SEEK_SET)<br /><br />    file_wrapper1 = environ['wsgi.file_wrapper'](filelike1)<br /><br />    filelike2 = file('/tmp/filetest-b.txt', 'w+')<br />    filelike2.write(string.ascii_uppercase)<br />    filelike2.flush()<br />    filelike2.seek(0, os.SEEK_SET)<br /><br />    file_wrapper2 = environ['wsgi.file_wrapper'](filelike2)<br /><br />    return file_wrapper2</pre>and then the for the case of returning instance of wsgi.file_wrapper which wasn&#8217;t the last created.<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br />    <br />    response_headers = [('Content-type', 'text/plain'),]<br />    start_response(status, response_headers)<br />    <br />    filelike1 = file('/tmp/filetest-a.txt', 'w+')<br />    filelike1.write(string.ascii_lowercase)<br />    filelike1.flush()<br />    filelike1.seek(0, os.SEEK_SET)<br /><br />    file_wrapper1 = environ['wsgi.file_wrapper'](filelike1)<br /><br />    filelike2 = file('/tmp/filetest-b.txt', 'w+')<br />    filelike2.write(string.ascii_uppercase)<br />    filelike2.flush()<br />    filelike2.seek(0, os.SEEK_SET)<br /><br />    file_wrapper2 = environ['wsgi.file_wrapper'](filelike2)<br /><br />    return file_wrapper1</pre>What is being checked for here is that the implementation isn&#8217;t just caching the last inputs given to a call of wsgi.file_wrapper and using that. The details must correspond to that used in the instance of wsgi.file_wrapper actually returned.<br /><br /><b>Closed File Object</b><br /><br />A file object in Python is a wrapper around a C FILE pointer. In turn the FILE pointer is a wrapper around an actual file descriptor. When performing optimisations to transmit a file using the UNIX sendfile() call it is necessary to use the file descriptor. That this is what occurs introduces a couple of complications that need to be catered for.<br /><br />The first is that the file descriptor and FILE pointer can technically differ as to their understanding of the current seek position within the file. This is because a FILE pointer implements a level of buffering and adjustments to the seek position of the FILE pointer, as well as file contents, may not be reflected in the file descriptor until a flush is performed, writing the data to disk.<br /><br />The prior test relating to the current position within the file object is intended to try and check for this disparity, although in practice whether it will capture a problem may be dependent on how a specific operating system implements FILE pointers. Important thing to note is that the current position within the file object should be determined by using the &#8216;tell()&#8217; method of the file object and not by interrogating the seek position from the file descriptor. If an implementation gets the information directly from the file descriptor, then ultimately it will likely fail at some point where code is performing seeks on the file object.<br /><br />The second complication, and which the following test will check, is the fact that there are multiple handles to the actual file. When dealing with a file object, if one closes the file object and then subsequently performs an operation on it a Python exception would be raised. If instead you held a reference to the file descriptor only and the file object was closed, you may not get an error back. This would be the case where the file descriptor had since been reused.<br /><br />As a result, if an implementation of wsgi.file_wrapper caches a reference to the file descriptor up front when first called, and then uses that when writing the file contents back as the response content, if the file object had been closed in between, then the wrong file contents could be returned if the file descriptor had been reused.<br /><br />A correct implementation should delay to the last moment obtaining a reference to the file descriptor. If the file object had been closed in the interim this should see a Python exception if implementation of wsgi.file_wrapper is done in Python code, or &#8216;-1&#8217; being returned by &#8216;PyObject_AsFileDescriptor()&#8217; if implemented in C code. If in C code, it should technically then fallback onto attempting to stream the file object, since a non file object would also result in &#8216;-1&#8217; being returned, in which case it should fail when trying to read data from the file object.<br /><br />The test for this then is to use wsgi.file_wrapper to create the result to return and before that is actually returned close the file object.<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br />    <br />    response_headers = [('Content-type', 'text/plain'),]<br />    start_response(status, response_headers)<br />    <br />    filelike = file('/tmp/filetest-a.txt', 'w+')<br />    filelike.write(string.ascii_lowercase)<br />    filelike.flush()<br />    filelike.seek(0, os.SEEK_SET)<br /><br />    file_wrapper = environ['wsgi.file_wrapper'](filelike)<br /><br />    filelike.close()<br /><br />    return file_wrapper</pre>One should also test the variation of where the file object is closed before wsgi.file_wrapper is invoked to create the return value for the WSGI application.<pre>import os<br />import string<br /><br />def application(environ, start_response):<br />    status = '200 OK'<br />    <br />    response_headers = [('Content-type', 'text/plain'),]<br />    start_response(status, response_headers)<br />    <br />    filelike = file('/tmp/filetest.txt', 'w+')<br />    filelike.write(string.ascii_lowercase)<br />    filelike.flush()<br />    filelike.seek(0, os.SEEK_SET)<br /><br />    filelike.close()<br /><br />    file_wrapper = environ['wsgi.file_wrapper'](filelike)<br /><br />    return file_wrapper</pre>However wsgi.file_wrapper is implemented, it should result in the error being detected. Because processing of the result is being done after having returned from the WSGI application, the fact that an error occurred would normally be logged in some way and the request terminated with the connection to HTTP client being abruptly closed. That is, there isn&#8217;t a way of raising an exception in the context of the original WSGI application.<br /><br />So, these are the tests. In a future blog post I will show how wsgi.file_wrapper should be implemented.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/13609779138164842374' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/13609779138164842374' rel='author' title='author profile'>
<span itemprop='name'>Graham Dumpleton</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html' itemprop='url'/>
<a class='timestamp-link' href='http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2011-01-22T17:20:00+11:00'>5:20&#8239;PM</abbr></a>
</span>
<span class='post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post/2363643920942057324/3019441481164740419' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3019441481164740419&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3019441481164740419&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3019441481164740419&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3019441481164740419&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3019441481164740419&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='http://blog.dscpl.com.au/search/label/python' rel='tag'>python</a>,
<a href='http://blog.dscpl.com.au/search/label/wsgi' rel='tag'>wsgi</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>3 comments:</h4>
<div id='Blog1_comments-block-wrapper'>
<dl class='avatar-comment-indent' id='comments-block'>
<dt class='comment-author ' id='c1483494576224243517'>
<a name='c1483494576224243517'></a>
<div class="avatar-image-container vcard"><span dir="ltr"><a href="https://www.blogger.com/profile/15155998626202067226" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-1483494576224243517-15155998626202067226"><img src="https://resources.blogblog.com/img/blank.gif" width="35" height="35" class="delayLoad" style="display: none;" longdesc="//3.bp.blogspot.com/_krv8BoCPKTQ/SaqKK1ufAGI/AAAAAAAAAG4/KQtfrJWj2GU/S45-s35/mugshot2.jpg" alt="" title="Marius Gedminas">

<noscript><img src="//3.bp.blogspot.com/_krv8BoCPKTQ/SaqKK1ufAGI/AAAAAAAAAG4/KQtfrJWj2GU/S45-s35/mugshot2.jpg" width="35" height="35" class="photo" alt=""></noscript></a></span></div>
<a href='https://www.blogger.com/profile/15155998626202067226' rel='nofollow'>Marius Gedminas</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-1483494576224243517'>
<p>
Excellent!<br /><br />Do you plan to build an automated test suite out of this?
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html?showComment=1295711877312#c1483494576224243517' title='comment permalink'>
January 23, 2011 at 2:57&#8239;AM
</a>
<span class='item-control blog-admin pid-1106634002'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/1483494576224243517' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
<dt class='comment-author blog-author' id='c5127164062674947938'>
<a name='c5127164062674947938'></a>
<div class="avatar-image-container avatar-stock"><span dir="ltr"><a href="https://www.blogger.com/profile/13609779138164842374" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-5127164062674947938-13609779138164842374"><img src="//www.blogger.com/img/blogger_logo_round_35.png" width="35" height="35" alt="" title="Graham Dumpleton">

</a></span></div>
<a href='https://www.blogger.com/profile/13609779138164842374' rel='nofollow'>Graham Dumpleton</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-5127164062674947938'>
<p>
There are two sides to automated testing. The client side, which is easy, and the server side, which isn&#39;t. The server side is a problem if the intention is to make it easy to apply the tests across multiple WSGI servers as how you deploy a WSGI application with each is different. Even if you focus on just Apache/mod_wsgi, it can get complicated if you have to adjust the Apache configuration between requests and restart the server. The old mod_python package had a system for doing just this, but it was quite messy. Time is better spent elsewhere at the moment.
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html?showComment=1295728453140#c5127164062674947938' title='comment permalink'>
January 23, 2011 at 7:34&#8239;AM
</a>
<span class='item-control blog-admin pid-1526776468'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/5127164062674947938' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
<dt class='comment-author blog-author' id='c3874691770147144653'>
<a name='c3874691770147144653'></a>
<div class="avatar-image-container avatar-stock"><span dir="ltr"><a href="https://www.blogger.com/profile/13609779138164842374" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-3874691770147144653-13609779138164842374"><img src="//www.blogger.com/img/blogger_logo_round_35.png" width="35" height="35" alt="" title="Graham Dumpleton">

</a></span></div>
<a href='https://www.blogger.com/profile/13609779138164842374' rel='nofollow'>Graham Dumpleton</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-3874691770147144653'>
<p>
For reference, appears that there is a move to have sendfile() as part of Python libraries. See http://bugs.python.org/issue10882
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html?showComment=1295731083610#c3874691770147144653' title='comment permalink'>
January 23, 2011 at 8:18&#8239;AM
</a>
<span class='item-control blog-admin pid-1526776468'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/3874691770147144653' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
</dl>
</div>
<p class='comment-footer'>
<a href='https://www.blogger.com/comment/fullpage/post/2363643920942057324/3019441481164740419' onclick=''>Post a Comment</a>
</p>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='http://blog.dscpl.com.au/2011/01/awesome-year-for-python-web-hosting.html' id='Blog1_blog-pager-newer-link' title='Newer Post'>Newer Post</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='http://blog.dscpl.com.au/2011/01/decorating-wsgi-applications.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='http://blog.dscpl.com.au/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='http://blog.dscpl.com.au/feeds/3019441481164740419/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget Profile' data-version='1' id='Profile1'>
<h2>About Me</h2>
<div class='widget-content'>
<dl class='profile-datablock'>
<dt class='profile-data'>
<a class='profile-name-link g-profile' href='https://www.blogger.com/profile/13609779138164842374' rel='author' style='background-image: url(//www.blogger.com/img/logo-16.png);'>
Graham Dumpleton
</a>
</dt>
</dl>
<a class='profile-link' href='https://www.blogger.com/profile/13609779138164842374' rel='author'>View my complete profile</a>
<div class='clear'></div>
</div>
</div><div class='widget PageList' data-version='1' id='PageList1'>
<h2>Quick Links</h2>
<div class='widget-content'>
<ul>
<li>
<a href='http://blog.dscpl.com.au/p/decorators-and-monkey-patching.html'>Decorators and monkey patching.</a>
</li>
<li>
<a href='http://blog.dscpl.com.au/p/using-python-with-docker.html'>Using Python with Docker.</a>
</li>
</ul>
<div class='clear'></div>
</div>
</div><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<select id='BlogArchive1_ArchiveMenu'>
<option value=''>Blog Archive</option>
<option value='http://blog.dscpl.com.au/2019/01/'>January (3)</option>
<option value='http://blog.dscpl.com.au/2018/12/'>December (4)</option>
<option value='http://blog.dscpl.com.au/2018/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2018/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2018/01/'>January (1)</option>
<option value='http://blog.dscpl.com.au/2017/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2016/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2016/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2016/07/'>July (1)</option>
<option value='http://blog.dscpl.com.au/2016/04/'>April (2)</option>
<option value='http://blog.dscpl.com.au/2016/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2016/02/'>February (2)</option>
<option value='http://blog.dscpl.com.au/2016/01/'>January (3)</option>
<option value='http://blog.dscpl.com.au/2015/12/'>December (6)</option>
<option value='http://blog.dscpl.com.au/2015/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2015/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2015/07/'>July (2)</option>
<option value='http://blog.dscpl.com.au/2015/06/'>June (5)</option>
<option value='http://blog.dscpl.com.au/2015/05/'>May (7)</option>
<option value='http://blog.dscpl.com.au/2015/04/'>April (4)</option>
<option value='http://blog.dscpl.com.au/2015/03/'>March (4)</option>
<option value='http://blog.dscpl.com.au/2015/01/'>January (2)</option>
<option value='http://blog.dscpl.com.au/2014/12/'>December (4)</option>
<option value='http://blog.dscpl.com.au/2014/11/'>November (1)</option>
<option value='http://blog.dscpl.com.au/2014/09/'>September (7)</option>
<option value='http://blog.dscpl.com.au/2014/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2014/05/'>May (1)</option>
<option value='http://blog.dscpl.com.au/2014/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2014/02/'>February (4)</option>
<option value='http://blog.dscpl.com.au/2014/01/'>January (8)</option>
<option value='http://blog.dscpl.com.au/2013/12/'>December (1)</option>
<option value='http://blog.dscpl.com.au/2012/12/'>December (1)</option>
<option value='http://blog.dscpl.com.au/2012/10/'>October (4)</option>
<option value='http://blog.dscpl.com.au/2012/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2011/11/'>November (1)</option>
<option value='http://blog.dscpl.com.au/2011/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2011/09/'>September (1)</option>
<option value='http://blog.dscpl.com.au/2011/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2011/01/'>January (5)</option>
<option value='http://blog.dscpl.com.au/2010/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2010/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2010/08/'>August (2)</option>
<option value='http://blog.dscpl.com.au/2010/06/'>June (2)</option>
<option value='http://blog.dscpl.com.au/2010/05/'>May (2)</option>
<option value='http://blog.dscpl.com.au/2010/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2010/03/'>March (3)</option>
<option value='http://blog.dscpl.com.au/2009/11/'>November (4)</option>
<option value='http://blog.dscpl.com.au/2009/10/'>October (3)</option>
<option value='http://blog.dscpl.com.au/2009/09/'>September (1)</option>
<option value='http://blog.dscpl.com.au/2009/08/'>August (3)</option>
<option value='http://blog.dscpl.com.au/2009/05/'>May (2)</option>
<option value='http://blog.dscpl.com.au/2009/04/'>April (5)</option>
<option value='http://blog.dscpl.com.au/2009/03/'>March (5)</option>
<option value='http://blog.dscpl.com.au/2009/02/'>February (1)</option>
<option value='http://blog.dscpl.com.au/2008/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2008/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2008/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2007/11/'>November (2)</option>
<option value='http://blog.dscpl.com.au/2007/10/'>October (3)</option>
<option value='http://blog.dscpl.com.au/2007/09/'>September (3)</option>
<option value='http://blog.dscpl.com.au/2007/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2007/07/'>July (2)</option>
<option value='http://blog.dscpl.com.au/2007/03/'>March (2)</option>
</select>
</div>
</div>
<div class='clear'></div>
</div>
</div><div class='widget Label' data-version='1' id='Label1'>
<h2>Labels</h2>
<div class='widget-content list-label-widget-content'>
<ul>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/python'>python</a>
<span dir='ltr'>(111)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/mod_wsgi'>mod_wsgi</a>
<span dir='ltr'>(86)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/wsgi'>wsgi</a>
<span dir='ltr'>(58)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/apache'>apache</a>
<span dir='ltr'>(35)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/docker'>docker</a>
<span dir='ltr'>(34)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/openshift'>openshift</a>
<span dir='ltr'>(26)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/decorators'>decorators</a>
<span dir='ltr'>(15)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/django'>django</a>
<span dir='ltr'>(13)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/kubernetes'>kubernetes</a>
<span dir='ltr'>(12)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/mod_python'>mod_python</a>
<span dir='ltr'>(9)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/red%20hat'>red hat</a>
<span dir='ltr'>(9)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/ipython'>ipython</a>
<span dir='ltr'>(7)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/jupyterhub'>jupyterhub</a>
<span dir='ltr'>(7)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/new%20relic'>new relic</a>
<span dir='ltr'>(6)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/wrapt'>wrapt</a>
<span dir='ltr'>(6)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/pycon'>pycon</a>
<span dir='ltr'>(5)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/s2i'>s2i</a>
<span dir='ltr'>(4)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/gunicorn'>gunicorn</a>
<span dir='ltr'>(3)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/uWSGI'>uWSGI</a>
<span dir='ltr'>(3)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/datadog'>datadog</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/nginx'>nginx</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/statsd'>statsd</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/web2py'>web2py</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/async'>async</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/dyndns53'>dyndns53</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/fastcgi'>fastcgi</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/heroku'>heroku</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/jupyter'>jupyter</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/lektor'>lektor</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/php'>php</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/shiv'>shiv</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/testing'>testing</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/tornado'>tornado</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/warpdrive'>warpdrive</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/zipapp'>zipapp</a>
<span dir='ltr'>(1)</span>
</li>
</ul>
<div class='clear'></div>
</div>
</div></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot section' id='footer-1'><div class='widget AdSense' data-version='1' id='AdSense1'>
<div class='widget-content'>
<script type="text/javascript"><!--
google_ad_client="pub-6433235630058377";
google_ad_host="pub-1556223355139109";
google_ad_width=120;
google_ad_height=600;
google_ad_format="120x600_as";
google_ad_type="text";
google_ad_host_channel="0001";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="999999";
google_color_url="5588AA";
google_color_text="666666";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class='clear'></div>
</div>
</div></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot no-items section' id='footer-2-1'></div>
</td>
<td class='columns-cell'>
<div class='foot no-items section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Simple theme. Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/552934507-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY7o8UH1j6F9Mi0RXpTKdTIzrz99CA:1757388526270';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d2363643920942057324','//blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html','2363643920942057324');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '2363643920942057324', 'title': 'Graham Dumpleton', 'url': 'http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html', 'canonicalUrl': 'http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html', 'homepageUrl': 'http://blog.dscpl.com.au/', 'searchUrl': 'http://blog.dscpl.com.au/search', 'canonicalHomepageUrl': 'http://blog.dscpl.com.au/', 'blogspotFaviconUrl': 'http://blog.dscpl.com.au/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': true, 'httpsEnabled': false, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Graham Dumpleton - RSS\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/2363643920942057324/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/3019441481164740419/comments/default\x22 /\x3e\n', 'meTag': '', 'adsenseClientId': 'ca-pub-6433235630058377', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': true, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/b4594f574ba3c273', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'X', 'key': 'twitter', 'shareMessage': 'Share to X', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '3019441481164740419', 'pageName': 'Testing a wsgi.file_wrapper implementation.', 'pageTitle': 'Graham Dumpleton: Testing a wsgi.file_wrapper implementation.'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'Simple', 'localizedName': 'Simple', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false, 'variant': 'pale', 'variantId': 'pale'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Testing a wsgi.file_wrapper implementation.', 'description': 'Not many WSGI servers or gateways have attempted to provide an implementation of the wsgi.file_wrapper extension. Of those, some provide the...', 'url': 'http://blog.dscpl.com.au/2011/01/testing-wsgifilewrapper-implementation.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 3019441481164740419}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/3842676126-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/828616780-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_ProfileView', new _WidgetInfo('Profile1', 'sidebar-right-1', document.getElementById('Profile1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'sidebar-right-1', document.getElementById('PageList1'), {'title': 'Quick Links', 'links': [{'isCurrentPage': false, 'href': 'http://blog.dscpl.com.au/p/decorators-and-monkey-patching.html', 'id': '3350721465154129789', 'title': 'Decorators and monkey patching.'}, {'isCurrentPage': false, 'href': 'http://blog.dscpl.com.au/p/using-python-with-docker.html', 'id': '5591286857776935907', 'title': 'Using Python with Docker.'}], 'mobile': false, 'showPlaceholder': true, 'hasCurrentPage': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LabelView', new _WidgetInfo('Label1', 'sidebar-right-1', document.getElementById('Label1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AdSenseView', new _WidgetInfo('AdSense1', 'footer-1', document.getElementById('AdSense1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>