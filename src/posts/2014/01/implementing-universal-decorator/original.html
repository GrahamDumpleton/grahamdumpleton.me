<!DOCTYPE html>
<html class='v2' dir='ltr' lang='en'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/2508126174-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='http://blog.dscpl.com.au/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Graham Dumpleton - Atom" href="http://blog.dscpl.com.au/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Graham Dumpleton - RSS" href="http://blog.dscpl.com.au/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Graham Dumpleton - Atom" href="https://www.blogger.com/feeds/2363643920942057324/posts/default" />

<link rel="alternate" type="application/atom+xml" title="Graham Dumpleton - Atom" href="http://blog.dscpl.com.au/feeds/7588699231967083693/comments/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<meta content='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html' property='og:url'/>
<meta content='Implementing a universal decorator.' property='og:title'/>
<meta content=' This is the fourth post in my series of blog posts about Python decorators and how I believe they are generally poorly implemented. It foll...' property='og:description'/>
<title>Graham Dumpleton: Implementing a universal decorator.</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */
/* Content
----------------------------------------------- */
body {
font: normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #222222;
background: #66bbdd none repeat scroll top left;
padding: 0 40px 40px 40px;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2187bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #32aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 40px rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 5px rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 10px #333333;
box-shadow: 0 0 40px rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 10px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #3299bb;
text-shadow: -1px -1px 1px rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #3299bb;
}
.Header .description {
font-size: 140%;
color: #777777;
}
.header-inner .Header .titlewrapper {
padding: 22px 30px;
}
.header-inner .Header .descriptionwrapper {
padding: 0 30px;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 1px solid #eeeeee;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #eeeeee;
border-left: 0 solid #eeeeee;
border-right: 0 solid #eeeeee;
}
.tabs-inner .widget ul {
background: #f5f5f5 url(https://resources.blogblog.com/blogblog/data/1kt/simple/gradients_light.png) repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #eeeeee;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #999999;
border-left: 1px solid #ffffff;
border-right: 1px solid #eeeeee;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid #eeeeee;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid #eeeeee;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid #eeeeee;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: transparent;
color: #222222;
padding: inherit;
letter-spacing: inherit;
margin: inherit;
}
.main-inner {
padding-top: 30px;
padding-bottom: 30px;
}
.main-inner .column-center-inner {
padding: 0 15px;
}
.main-inner .column-center-inner .section {
margin: 0 15px;
}
.post {
margin: 0 0 25px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #222222;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #f9f9f9;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid #eeeeee;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #eeeeee;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #f9f9f9;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid #eeeeee;
}
.blog-pager {
background: transparent none no-repeat scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 0 dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #222222;
}
.mobile-link-button {
background-color: #2187bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #eeeeee;
border-bottom: 1px solid #eeeeee;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #eeeeee;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1020px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1020px;
max-width: 1020px;
_width: 1020px;
}
.main-inner .columns {
padding-left: 0px;
padding-right: 200px;
}
.main-inner .fauxcolumn-center-outer {
left: 0px;
right: 200px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0px") -
parseInt("200px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0px;
}
.main-inner .fauxcolumn-right-outer {
width: 200px;
}
.main-inner .column-left-outer {
width: 0px;
right: 100%;
margin-left: -0px;
}
.main-inner .column-right-outer {
width: 200px;
margin-right: -200px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2363643920942057324&amp;zx=8e425bf4-e933-49a5-a874-6a5d9cccad39' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2363643920942057324&amp;zx=8e425bf4-e933-49a5-a874-6a5d9cccad39' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

<!-- data-ad-client=ca-pub-6433235630058377 -->

</head>
<body class='loading variant-pale'>
<div class='navbar section' id='navbar' name='Navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar/2363643920942057324?po\x3d7588699231967083693\x26origin\x3dhttp://blog.dscpl.com.au',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='http://blog.dscpl.com.au/'>
Graham Dumpleton
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>
</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol' name='Cross-Column'></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Thursday, January 9, 2014</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='2363643920942057324' itemprop='blogId'/>
<meta content='7588699231967083693' itemprop='postId'/>
<a name='7588699231967083693'></a>
<h3 class='post-title entry-title' itemprop='name'>
Implementing a universal decorator.
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-7588699231967083693' itemprop='description articleBody'>
<div class="tr_bq">
This is the fourth post in my series of blog posts about Python decorators and how I believe they are generally poorly implemented. It follows on from the previous post titled '<a href="http://blog.dscpl.com.au/2014/01/implementing-factory-for-creating.html">Implementing a factory for creating decorators</a>', with the very first post in the series being '<a href="http://blog.dscpl.com.au/2014/01/how-you-implemented-your-python.html">How you implemented your Python decorator is wrong</a>'.</div>
<br />
In the second post of this series I described a better way of building a decorator which avoided a number of issues I outlined with the typical way in which decorators are coded. This entailed a measure of boiler plate code which needed to be replicated each time. In the previous post to this one I described how we could use a decorator as a decorator factory, and a bit of delegation to hide the boiler plate code and reduce what a user needed to actually declare for a new decorator.<br />
<br />
In the prior post I also started to walk through some customisations which could be made to the decorator pattern which would allow the decorator wrapper function provided by a user to ascertain in what context it was used in. That is, for the wrapper function to be able to determine whether it was applied to a function, an instance method, a class method or a class type. The ability to determine the context in this way is what I called a universal decorator, as it avoided the need to have separate decorator implementations for use in each circumstance as is done now with a more traditional way of implementing a decorator.<br />
<br />
The walk through got as far as showing how one could distinguish between when the decorator was used on a normal function vs an instance method. Unfortunately the change required to be able to detect when an instance method was called via the class would cause problems for a class method or static method, so we still have a bit more work to do.<br />
<br />
In this post I will describe how we can accommodate the cases of a class method and a static method as well as explore other use cases which may give us problems in trying to come up with this pattern for a universal decorator.<br />
<br />
<h3>
Normal functions vs instance methods</h3>
<br />
The pattern for our universal decorator as described so far was as follows:<br />
<blockquote class="tr_bq">
class bound_function_wrapper(object_proxy): &nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __init__(self, wrapped, instance, wrapper):<br />
&nbsp; &nbsp; &nbsp; &nbsp; super(bound_function_wrapper, self).__init__(wrapped)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.instance = instance<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.wrapper = wrapper&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __call__(self, *args, **kwargs):<br />
&nbsp; &nbsp; &nbsp; &nbsp; if self.instance is None:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance, args = args[0], args[1:]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wrapped = functools.partial(self.wrapped, instance)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(wrapped, instance, args, kwargs)<br />
&nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, self.instance, args, kwargs)&nbsp;</blockquote>
<blockquote class="tr_bq">
class function_wrapper(object_proxy):&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __init__(self, wrapped, wrapper):<br />
&nbsp; &nbsp; &nbsp; &nbsp; super(function_wrapper, self).__init__(wrapped)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.wrapper = wrapper&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __get__(self, instance, owner):<br />
&nbsp; &nbsp; &nbsp; &nbsp; wrapped = self.wrapped.__get__(instance, owner)<br />
&nbsp; &nbsp; &nbsp; &nbsp; return bound_function_wrapper(wrapped, instance, self.wrapper)&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __call__(self, *args, **kwargs):<br />
&nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, None, args, kwargs)</blockquote>
This was used in conjunction with our decorator factory:<br />
<blockquote class="tr_bq">
def decorator(wrapper):<br />
&nbsp; &nbsp; @functools.wraps(wrapper)<br />
&nbsp; &nbsp; def _decorator(wrapped):<br />
&nbsp; &nbsp; &nbsp; &nbsp; return function_wrapper(wrapped, wrapper)<br />
&nbsp; &nbsp; return _decorator</blockquote>
To test whether everything is working how we want we used our decorator factory to create a decorator which would dump out the values of any instance the wrapped function is bound to, and the arguments passed to the call when executed.<br />
<blockquote class="tr_bq">
@decorator<br />
def my_function_wrapper(wrapped, instance, args, kwargs):<br />
&nbsp; &nbsp; print('INSTANCE', instance)<br />
&nbsp; &nbsp; print('ARGS', args)<br />
&nbsp; &nbsp; return wrapped(*args, **kwargs)&nbsp;</blockquote>
This gave us the desired results for when the decorator was applied to a normal function and instance method, including when an instance method was called via the class and the instance passed in explicitly.<br />
<blockquote class="tr_bq">
@my_function_wrapper<br />
def function(a, b):<br />
&nbsp; &nbsp; pass</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; function(1, 2)<br />
INSTANCE None<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
class Class(object):<br />
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; def function_im(self, a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote class="tr_bq">
c = Class()&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_im(1, 2)<br />
INSTANCE &lt;__main__.Class object at 0x1085ca9d0&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_im(c, 1, 2)<br />
INSTANCE &lt;__main__.Class object at 0x1085ca9d0&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
The change to support the latter however, broke things for the case of the decorator being applied to a class method. Similarly for a static method.<br />
<blockquote class="tr_bq">
class Class(object):<br />
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; @classmethod<br />
&nbsp; &nbsp; def function_cm(self, a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; @staticmethod<br />
&nbsp; &nbsp; def function_sm(a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_cm(1, 2)<br />
INSTANCE 1<br />
ARGS (2,)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_sm(1, 2)<br />
INSTANCE 1<br />
ARGS (2,)&nbsp;</blockquote>
<h3>
Class methods and static methods</h3>
<br />
The point we are at therefore, is that in the case where the instance is passed as None, we need to be able to distinguish between the three cases of:<br />
<br />
<ul>
<li>an instance method being called via the class</li>
<li>a class method being called</li>
<li>a static method being called</li>
</ul>
<br />
One way this can be done is by looking at the __self__ attribute of the bound function. This attribute will provide information about the type of object which the function was bound to at that specific point in time. Lets first check this out for where a method is called via the class.<br />
<blockquote class="tr_bq">
&gt;&gt;&gt; print(Class.function_im.__self__)<br />
None&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; print(Class.function_cm.__self__)<br />
&lt;class '__main__.Class'&gt;&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; print(Class.function_sm.__self__)<br />
Traceback (most recent call last):<br />
&nbsp; File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br />
&nbsp; File "test.py", line 19, in __getattr__<br />
&nbsp; &nbsp; return getattr(self.wrapped, name)<br />
AttributeError: 'function' object has no attribute '__self__'</blockquote>
So for the case of calling an instance method via the class, __self__ will be None, for a class method it will be the class type and in the case of a static method, there will not even be a __self__ attribute. This would therefore appear to give us a way of detecting the different cases.<br />
<br />
Before we code up a solution based on this though, lets check with Python 3 just to be sure we are okay there and that nothing has changed.<br />
<blockquote class="tr_bq">
&gt;&gt;&gt; print(Class.function_im.__self__)<br />
Traceback (most recent call last):<br />
&nbsp; File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br />
&nbsp; File "dectest.py", line 19, in __getattr__<br />
&nbsp; &nbsp; return getattr(self.wrapped, name)<br />
AttributeError: 'function' object has no attribute '__self__'&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; print(Class.function_cm.__self__)<br />
&lt;class '__main__.Class'&gt;&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; print(Class.function_sm.__self__)<br />
Traceback (most recent call last):<br />
&nbsp; File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br />
&nbsp; File "test.py", line 19, in __getattr__<br />
&nbsp; &nbsp; return getattr(self.wrapped, name)<br />
AttributeError: 'function' object has no attribute '__self__'</blockquote>
That isn't good, Python 3 behaves differently to Python 2, meaning we aren't going to be able to use this approach. Why is this case?<br />
<br />
The reason for this is that in Python 3 they decided to eliminate the idea of an unbound method and this check was relying on the fact that when accessing an instance method via the class, it would actually return an instance of an unbound method for which the __self__ attribute was None. So although we can distinguish the case for a class method still, we can now no longer distinguish the case of calling an instance method via the class, from the case of calling a static method.<br />
<br />
The lack of this ability therefore leaves us with a bit of a problem for Python 3 and the one alternative isn't necessarily a completely fool proof way of doing it.<br />
<br />
This alternative is in the constructor of the function wrapper, to look at the type of the wrapped object and determine if it is an instance of a class method or static method. This information can then be passed through to the bound function wrapper and checked.<br />
<blockquote class="tr_bq">
class bound_function_wrapper(object_proxy):&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __init__(self, wrapped, instance, wrapper, binding):<br />
&nbsp; &nbsp; &nbsp; &nbsp; super(bound_function_wrapper, self).__init__(wrapped)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.instance = instance<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.wrapper = wrapper<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.binding = binding&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __call__(self, *args, **kwargs):<br />
&nbsp; &nbsp; &nbsp; &nbsp; if self.binding == 'function' and self.instance is None:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance, args = args[0], args[1:]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wrapped = functools.partial(self.wrapped, instance)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(wrapped, instance, args, kwargs)&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, self.instance, args, kwargs)&nbsp;</blockquote>
<blockquote class="tr_bq">
class function_wrapper(object_proxy):&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __init__(self, wrapped, wrapper):<br />
&nbsp; &nbsp; &nbsp; &nbsp; super(function_wrapper, self).__init__(wrapped)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.wrapper = wrapper&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; &nbsp; &nbsp; if isinstance(wrapped, classmethod):<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding = 'classmethod'<br />
&nbsp; &nbsp; &nbsp; &nbsp; elif isinstance(wrapped, staticmethod):<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding = 'staticmethod'<br />
&nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding = 'function'&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __get__(self, instance, owner):<br />
&nbsp; &nbsp; &nbsp; &nbsp; wrapped = self.wrapped.__get__(instance, owner)<br />
&nbsp; &nbsp; &nbsp; &nbsp; return bound_function_wrapper(wrapped, instance, self.wrapper,&nbsp;&nbsp;self.binding)&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __call__(self, *args, **kwargs):<br />
&nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, None, args, kwargs)</blockquote>
Now this test is a bit fragile, but as I showed before though, the traditional way that a decorator is written will fail if wrapped around a class method or static method as it doesn't honour the descriptor protocol. As such it is a pretty safe bet right now that I will only ever find an actual class method or static method object because no one would be using decorators around them.<br />
<br />
If someone is actually implementing the descriptor protocol in their decorator, hopefully they would also be using an object proxy as is done here. Because the object proxy implements __class__ as a property, it would return the class of the wrapped object, this should mean that an isinstance() check will still be successful as isinstance() gives priority to what __class__ yields rather than the actual type of the object.<br />
<br />
Anyway, trying out our tests again with this change we get:<br />
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_im(1,2)<br />
INSTANCE &lt;__main__.Class object at 0x101f973d0&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_im(c, 1, 2)<br />
INSTANCE &lt;__main__.Class object at 0x101f973d0&gt;<br />
ARGS (1, 2)</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_cm(1,2)<br />
INSTANCE &lt;__main__.Class object at 0x101f973d0&gt;<br />
ARGS (1, 2)</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_cm(1, 2)<br />
INSTANCE None<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_sm(1,2)<br />
INSTANCE &lt;__main__.Class object at 0x101f973d0&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_sm(1, 2)<br />
INSTANCE None<br />
ARGS (1, 2)</blockquote>
Success, we have fixed the issue with the argument list when both a class method and a static method are called.<br />
<br />
The problem now is that although the instance argument is fine for the case of an instance method call, whether that be via the instance or the class, the instance as passed for a class method and static method aren't particularly useful as we can't use it to distinguish them from other cases.<br />
<br />
Ideally what we want in this circumstance is that for a class method call we want the instance argument to always be the class type, and for the case of a static method call, for it to always be None.<br />
<br />
For the case of a static method, we could just check for 'staticmethod' from when we checked the type of object which was wrapped.<br />
<br />
For the case of a class method, if we look back at our test to see if we could use the __self__ attribute, what we found was that for the class method, __self__ was the class instance and for a static method the attribute didn't exist.<br />
<br />
What we can therefore do, is if the type of the wrapped object wasn't a function, then we can lookup up the value of __self__, defaulting to None if it doesn't exist. This one check will cater for both cases.<br />
<br />
What we now therefore have is:<br />
<blockquote class="tr_bq">
class bound_function_wrapper(object_proxy):<br />
&nbsp; &nbsp; def __init__(self, wrapped, instance, wrapper, binding):<br />
&nbsp; &nbsp; &nbsp; &nbsp; super(bound_function_wrapper, self).__init__(wrapped)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.instance = instance<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.wrapper = wrapper<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.binding = binding&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __call__(self, *args, **kwargs):<br />
&nbsp; &nbsp; &nbsp; &nbsp; if self.binding == 'function':<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if self.instance is None:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance, args = args[0], args[1:]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wrapped = functools.partial(self.wrapped, instance)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(wrapped, instance, args, kwargs)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, self.instance, args, kwargs)<br />
&nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance = getattr(self.wrapped, '__self__', None)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, instance, args, kwargs)</blockquote>
and if we run our tests one more time, we finally get the result we have been looking for:<br />
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_im(1,2)<br />
INSTANCE &lt;__main__.Class object at 0x10c2c43d0&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_im(c, 1, 2)<br />
INSTANCE &lt;__main__.Class object at 0x10c2c43d0&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_cm(1,2)<br />
INSTANCE &lt;class '__main__.Class'&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_cm(1, 2)<br />
INSTANCE &lt;class '__main__.Class'&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_sm(1,2)<br />
INSTANCE None<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_sm(1, 2)<br />
INSTANCE None<br />
ARGS (1, 2)</blockquote>
Are we able to celebrate yet? Unfortunately not.<br />
<br />
<h3>
Multiple levels of binding</h3>
<br />
There is yet another obscure case we have yet to consider, one that I didn't even think of initially and only understood the problem when I started to see code breaking in crazy ways.<br />
<br />
This is when we take a reference to a method and reassign it back again as an attribute of a class, or even an instance of a class, and then call it via the alias so created. I only encountered this one due to some bizarre stuff a meta class was doing.<br />
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_rm = Class.function_im<br />
&gt;&gt;&gt; c.function_rm(1, 2)<br />
INSTANCE 1<br />
ARGS (2,)<br />
Traceback (most recent call last):<br />
&nbsp; File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br />
&nbsp; File "test.py", line 132, in __call__<br />
&nbsp; &nbsp; return self.wrapper(wrapped, instance, args, kwargs)<br />
&nbsp; File "test.py", line 58, in my_function_wrapper<br />
&nbsp; &nbsp; return wrapped(*args, **kwargs)<br />
TypeError: unbound method function_im() must be called with Class instance as first argument (got int instance instead)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_rm = Class.function_cm<br />
&gt;&gt;&gt; c.function_rm(1, 2)<br />
INSTANCE &lt;class '__main__.Class'&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_rm = Class.function_sm<br />
&gt;&gt;&gt; c.function_rm(1, 2)<br />
INSTANCE None<br />
ARGS (1, 2)</blockquote>
Things work fine for a class method or static method, but fails badly for an instance method.<br />
<br />
The problem here comes about because in accessing the instance method the first time, it will return a bound function wrapper. That then gets assigned back as an attribute of the class.<br />
<br />
When a subsequent lookup is made via the new name, under normal circumstances binding would occur once more to bind it to the actual instance. In our implementation of the bound function wrapper, we do not however provide a __get__() method and thus this rebinding does not occur. The result is that on the subsequent call, it all falls apart.<br />
<br />
The solution therefore is that we need to add a __get__() method to the bound function wrapper which provides the ability to perform further binding. We only want to do this where the instance was None, indicating that the initial binding wasn't actually against an instance, and where we are dealing with an instance method and not a class method or static method.<br />
<br />
A further wrinkle is that we need to bind what was the original wrapped function and not the bound one. The simplest way of handling that is to pass a reference to the original function wrapper to the<br />
bound function wrapper and reach back into that to get the original wrapped function.<br />
<blockquote class="tr_bq">
class bound_function_wrapper(object_proxy):&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __init__(self, wrapped, instance, wrapper, binding, parent):<br />
&nbsp; &nbsp; &nbsp; &nbsp; super(bound_function_wrapper, self).__init__(wrapped)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.instance = instance<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.wrapper = wrapper<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.binding = binding<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.parent = parent&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __call__(self, *args, **kwargs):<br />
&nbsp; &nbsp; &nbsp; &nbsp; if self.binding == 'function':<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if self.instance is None:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance, args = args[0], args[1:]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wrapped = functools.partial(self.wrapped, instance)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(wrapped, instance, args, kwargs)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, self.instance, args, kwargs)<br />
&nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance = getattr(self.wrapped, '__self__', None)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, instance, args, kwargs)&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __get__(self, instance, owner):<br />
&nbsp; &nbsp; &nbsp; &nbsp; if self.instance is None and self.binding == 'function':<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; descriptor = self.parent.wrapped.__get__(instance, owner)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return bound_function_wrapper(descriptor, instance, self.wrapper,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding, self.parent)<br />
&nbsp; &nbsp; &nbsp; &nbsp; return self&nbsp;</blockquote>
<blockquote class="tr_bq">
class function_wrapper(object_proxy):&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __init__(self, wrapped, wrapper):<br />
&nbsp; &nbsp; &nbsp; &nbsp; super(function_wrapper, self).__init__(wrapped)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.wrapper = wrapper<br />
&nbsp; &nbsp; &nbsp; &nbsp; if isinstance(wrapped, classmethod):<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding = 'classmethod'<br />
&nbsp; &nbsp; &nbsp; &nbsp; elif isinstance(wrapped, staticmethod):<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding = 'staticmethod'<br />
&nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding = 'function'&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __get__(self, instance, owner):<br />
&nbsp; &nbsp; &nbsp; &nbsp; wrapped = self.wrapped.__get__(instance, owner)<br />
&nbsp; &nbsp; &nbsp; &nbsp; return bound_function_wrapper(wrapped, instance, self.wrapper,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.binding, self)&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; def __call__(self, *args, **kwargs):<br />
&nbsp; &nbsp; &nbsp; &nbsp; return self.wrapper(self.wrapped, None, args, kwargs)</blockquote>
Rerunning our most recent test once again we now get:<br />
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_rm = Class.function_im<br />
&gt;&gt;&gt; c.function_rm(1, 2)<br />
INSTANCE &lt;__main__.Class object at 0x105609790&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_rm = Class.function_cm<br />
&gt;&gt;&gt; c.function_rm(1, 2)<br />
INSTANCE &lt;class '__main__.Class'&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_rm = Class.function_sm<br />
&gt;&gt;&gt; c.function_rm(1, 2)<br />
INSTANCE None<br />
ARGS (1, 2)</blockquote>
<h3>
Order that decorators are applied</h3>
We must be getting close now. Everything appears to be working.<br />
<br />
If you had been paying close attention you would have noticed though that in all cases so far our decorator has always been placed outside of the existing decorators marking a method as either a class method or a static method. What happens if we reverse the order?<br />
<blockquote class="tr_bq">
class Class(object):<br />
&nbsp; &nbsp; @classmethod<br />
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; def function_cm(self, a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote class="tr_bq">
&nbsp; &nbsp; @staticmethod<br />
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; def function_sm(a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote class="tr_bq">
c = Class()&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_cm(1,2)<br />
INSTANCE None<br />
ARGS (&lt;class '__main__.Class'&gt;, 1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_cm(1, 2)<br />
INSTANCE None<br />
ARGS (&lt;class '__main__.Class'&gt;, 1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c.function_sm(1,2)<br />
INSTANCE None<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; Class.function_sm(1, 2)<br />
INSTANCE None<br />
ARGS (1, 2)</blockquote>
So it works as we would expect for a static method but not for a class method.<br />
<br />
At this point you gotta be thinking why I am bothering.<br />
<br />
As it turns out there is indeed absolutely nothing I can do about this one. But that isn't actually my fault.<br />
<br />
In this particular case, it actually can be seen as being a bug in Python itself. Specifically, the classmethod decorator doesn't itself honour the descriptor protocol when it calls whatever it is wrapping. This is the exact same problem I faulted decorators implemented using a closure for originally. If it wasn't for the classmethod decorator doing the wrong thing, everything would be perfect.<br />
<br />
For those who are interested in the details, you can check out <a href="http://bugs.python.org/issue19072">issue 19072</a> in the Python bug tracker. If I had tried hard I could well have got it fixed by the time Python 3.4 came out, but I simply didn't have the time nor the real motivation to satisfy all the requirements to get the fix accepted.<br />
<br />
<h3>
Decorating a class</h3>
<br />
Excluding that one case related to ordering of decorators for class methods, our pattern for implementing a universal decorator is looking good.<br />
<br />
I did mention though in the last post that the goal was that we could also distinguish when a decorator was applied to a class. So lets check that.<br />
<blockquote class="tr_bq">
@my_function_wrapper<br />
class Class(object):<br />
&nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote class="tr_bq">
&gt;&gt;&gt; c = Class()<br />
INSTANCE None<br />
ARGS ()</blockquote>
Based on that we aren't able to distinguish it from a normal function or a class method.<br />
<br />
If we think about it though, we are in this case wrapping an actual class, so the wrapped object which is passed to the decorator wrapper function will be the class itself. Lets print out the value of the wrapped argument passed to the decorator wrapper function as well and see whether that can be used to distinguish this case from others.<br />
<blockquote>
@decorator<br />
def my_function_wrapper(wrapped, instance, args, kwargs):<br />
&nbsp; &nbsp; print('WRAPPED', wrapped)<br />
&nbsp; &nbsp; print('INSTANCE', instance)<br />
&nbsp; &nbsp; print('ARGS', args)<br />
&nbsp; &nbsp; return wrapped(*args, **kwargs)&nbsp;</blockquote>
<blockquote>
@my_function_wrapper<br />
def function(a, b):<br />
&nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; function(1, 2)<br />
WRAPPED &lt;function function at 0x10e13bb18&gt;<br />
INSTANCE None<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote>
class Class(object):<br />
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; def function_im(self, a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass<br />
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; @classmethod<br />
&nbsp; &nbsp; def function_cm(self, a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass<br />
&nbsp; &nbsp; @my_function_wrapper<br />
&nbsp; &nbsp; @staticmethod<br />
&nbsp; &nbsp; def function_sm(a, b):<br />
&nbsp; &nbsp; &nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote>
c = Class()&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; c.function_im(1,2)<br />
WRAPPED &lt;bound method Class.function_im of &lt;__main__.Class object at 0x107e90950&gt;&gt;<br />
INSTANCE &lt;__main__.Class object at 0x107e90950&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; Class.function_im(c, 1, 2)<br />
WRAPPED &lt;functools.partial object at 0x107df3208&gt;<br />
INSTANCE &lt;__main__.Class object at 0x107e90950&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; c.function_cm(1,2)<br />
WRAPPED &lt;bound method type.function_cm of &lt;class '__main__.Class'&gt;&gt;<br />
INSTANCE &lt;class '__main__.Class'&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; Class.function_cm(1, 2)<br />
WRAPPED &lt;bound method type.function_cm of &lt;class '__main__.Class'&gt;&gt;<br />
INSTANCE &lt;class '__main__.Class'&gt;<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; c.function_sm(1,2)<br />
WRAPPED &lt;function function_sm at 0x107e918c0&gt;<br />
INSTANCE None<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; Class.function_sm(1, 2)<br />
WRAPPED &lt;function function_sm at 0x107e918c0&gt;<br />
INSTANCE None<br />
ARGS (1, 2)&nbsp;</blockquote>
<blockquote>
@my_function_wrapper<br />
class Class(object):<br />
&nbsp; &nbsp; pass&nbsp;</blockquote>
<blockquote>
c = Class()&nbsp;</blockquote>
<blockquote>
&gt;&gt;&gt; c = Class()<br />
WRAPPED &lt;class '__main__.Class'&gt;<br />
INSTANCE None<br />
ARGS ()</blockquote>
And the answer is yes, as it is the only case where wrapped will be a type object.<br />
<br />
<h3>
The structure of a universal decorator</h3>
<br />
The goal of a decorator, one decorator, that can be implemented and applied to normal functions, instance methods, class methods and classes is therefore achievable. The odd one out is static methods, but in practice these aren't really different to normal functions, just being contained in a different scope, so I think I will let that one slide.<br />
<br />
The information to identify the static method is actually available in the way the decorator works, but since there is nothing in the arguments passed to a static method that link it to the class it is contained in, there doesn't seem a point. If that information was required, it probably should have been a class method to begin with.<br />
<br />
Anyway, after all this work, our universal decorator then would be written as:<br />
<blockquote class="tr_bq">
@decorator<br />
def universal(wrapped, instance, args, kwargs):<br />
&nbsp; &nbsp; if instance is None:<br />
&nbsp; &nbsp; &nbsp; &nbsp; if inspect.isclass(wrapped):<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Decorator was applied to a class.<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return wrapped(*args, **kwargs)<br />
&nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Decorator was applied to a function or staticmethod.<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return wrapped(*args, **kwargs)<br />
&nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; if inspect.isclass(instance):<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Decorator was applied to a classmethod.<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return wrapped(*args, **kwargs)<br />
&nbsp; &nbsp; &nbsp; &nbsp; else:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Decorator was applied to an instancemethod.<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return wrapped(*args, **kwargs)</blockquote>
Are there actual uses for such a universal decorator? I believe there are some quite good examples and I will cover one in particular in a subsequent blog post.<br />
<br />
You also have frameworks such as Django which already use hacks to allow a decorator designed for use with a function, to be applied to an instance method. Turns out that the method they use is broken because it doesn't honour the descriptor protocol though. If you are interested in that one, see <a href="https://code.djangoproject.com/ticket/21247">issue 21247</a> in the Django bug tracker.<br />
<br />
I will not cover this example of a use case for a universal decorator just yet. Instead in my next blog post in this series I will look at issues around having decorators that have optional arguments and how to capture any such arguments so the decorator can make use of them.<br />
<br />
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/13609779138164842374' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/13609779138164842374' rel='author' title='author profile'>
<span itemprop='name'>Graham Dumpleton</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html' itemprop='url'/>
<a class='timestamp-link' href='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2014-01-09T23:06:00+11:00'>11:06&#8239;PM</abbr></a>
</span>
<span class='post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post/2363643920942057324/7588699231967083693' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=7588699231967083693&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=7588699231967083693&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=7588699231967083693&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=7588699231967083693&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=7588699231967083693&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='http://blog.dscpl.com.au/search/label/decorators' rel='tag'>decorators</a>,
<a href='http://blog.dscpl.com.au/search/label/python' rel='tag'>python</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>5 comments:</h4>
<div id='Blog1_comments-block-wrapper'>
<dl class='avatar-comment-indent' id='comments-block'>
<dt class='comment-author ' id='c5768868610626710319'>
<a name='c5768868610626710319'></a>
<div class="avatar-image-container avatar-stock"><span dir="ltr"><a href="https://www.blogger.com/profile/09154445172172701979" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-5768868610626710319-09154445172172701979"><img src="//www.blogger.com/img/blogger_logo_round_35.png" width="35" height="35" alt="" title="Unknown">

</a></span></div>
<a href='https://www.blogger.com/profile/09154445172172701979' rel='nofollow'>Unknown</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-5768868610626710319'>
<p>
In your first post on decorators your set a goal of &quot;Preservation of function argument specification&quot;, but after applying universal decorator, you described here, i still get a &quot;TypeError: &lt;...&gt; is not a code object&quot; when calling inspect.getargs() on decorated function.<br /><br />Is this not possible to preserve argspec?
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html?showComment=1389355770662#c5768868610626710319' title='comment permalink'>
January 10, 2014 at 11:09&#8239;PM
</a>
<span class='item-control blog-admin pid-2125147845'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/5768868610626710319' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
<dt class='comment-author blog-author' id='c387408894311700040'>
<a name='c387408894311700040'></a>
<div class="avatar-image-container avatar-stock"><span dir="ltr"><a href="https://www.blogger.com/profile/13609779138164842374" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-387408894311700040-13609779138164842374"><img src="//www.blogger.com/img/blogger_logo_round_35.png" width="35" height="35" alt="" title="Graham Dumpleton">

</a></span></div>
<a href='https://www.blogger.com/profile/13609779138164842374' rel='nofollow'>Graham Dumpleton</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-387408894311700040'>
<p>
In the blog post I said the example of the object proxy shown was not complete, you need the full implementation of that. Use the &#39;wrapt&#39; package off PyPi and if you still have a problem create an issue on github project for package.
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html?showComment=1389385627995#c387408894311700040' title='comment permalink'>
January 11, 2014 at 7:27&#8239;AM
</a>
<span class='item-control blog-admin pid-1526776468'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/387408894311700040' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
<dt class='comment-author ' id='c1730756527016902037'>
<a name='c1730756527016902037'></a>
<div class="avatar-image-container avatar-stock"><span dir="ltr"><a href="https://www.blogger.com/profile/04987092211724707506" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-1730756527016902037-04987092211724707506"><img src="//www.blogger.com/img/blogger_logo_round_35.png" width="35" height="35" alt="" title="Dave Brondsema">

</a></span></div>
<a href='https://www.blogger.com/profile/04987092211724707506' rel='nofollow'>Dave Brondsema</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-1730756527016902037'>
<p>
This series is awesome.  Extremely detailed and informative - a lot that I didn&#39;t know.  Thanks :)
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html?showComment=1389412533556#c1730756527016902037' title='comment permalink'>
January 11, 2014 at 2:55&#8239;PM
</a>
<span class='item-control blog-admin pid-534986605'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/1730756527016902037' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
<dt class='comment-author blog-author' id='c570404661381272229'>
<a name='c570404661381272229'></a>
<div class="avatar-image-container avatar-stock"><span dir="ltr"><a href="https://www.blogger.com/profile/13609779138164842374" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-570404661381272229-13609779138164842374"><img src="//www.blogger.com/img/blogger_logo_round_35.png" width="35" height="35" alt="" title="Graham Dumpleton">

</a></span></div>
<a href='https://www.blogger.com/profile/13609779138164842374' rel='nofollow'>Graham Dumpleton</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-570404661381272229'>
<p>
Actually looking up the documentation, the inspect.getargs() call is meant to be given a code object, not a function. Thus it is meant to be called as inspect.getargs(function.__code__). I suspect you were mistaking it with inspect.getargspec() which should work fine.
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html?showComment=1389432835943#c570404661381272229' title='comment permalink'>
January 11, 2014 at 8:33&#8239;PM
</a>
<span class='item-control blog-admin pid-1526776468'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/570404661381272229' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
<dt class='comment-author ' id='c9139619847519737862'>
<a name='c9139619847519737862'></a>
<div class="avatar-image-container avatar-stock"><span dir="ltr"><a href="https://www.blogger.com/profile/09154445172172701979" target="" rel="nofollow" onclick="" class="avatar-hovercard" id="av-9139619847519737862-09154445172172701979"><img src="//www.blogger.com/img/blogger_logo_round_35.png" width="35" height="35" alt="" title="Unknown">

</a></span></div>
<a href='https://www.blogger.com/profile/09154445172172701979' rel='nofollow'>Unknown</a>
said...
</dt>
<dd class='comment-body' id='Blog1_cmt-9139619847519737862'>
<p>
My bad, inspect.getargspec works just fine.<br /><br />And thank you for this post series, they are awesome.
</p>
</dd>
<dd class='comment-footer'>
<span class='comment-timestamp'>
<a href='http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html?showComment=1389599471482#c9139619847519737862' title='comment permalink'>
January 13, 2014 at 6:51&#8239;PM
</a>
<span class='item-control blog-admin pid-2125147845'>
<a class='comment-delete' href='https://www.blogger.com/comment/delete/2363643920942057324/9139619847519737862' title='Delete Comment'>
<img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
</a>
</span>
</span>
</dd>
</dl>
</div>
<p class='comment-footer'>
<a href='https://www.blogger.com/comment/fullpage/post/2363643920942057324/7588699231967083693' onclick=''>Post a Comment</a>
</p>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='http://blog.dscpl.com.au/2014/01/decorators-which-accept-arguments.html' id='Blog1_blog-pager-newer-link' title='Newer Post'>Newer Post</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='http://blog.dscpl.com.au/2014/01/implementing-factory-for-creating.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='http://blog.dscpl.com.au/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='http://blog.dscpl.com.au/feeds/7588699231967083693/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget Profile' data-version='1' id='Profile1'>
<h2>About Me</h2>
<div class='widget-content'>
<dl class='profile-datablock'>
<dt class='profile-data'>
<a class='profile-name-link g-profile' href='https://www.blogger.com/profile/13609779138164842374' rel='author' style='background-image: url(//www.blogger.com/img/logo-16.png);'>
Graham Dumpleton
</a>
</dt>
</dl>
<a class='profile-link' href='https://www.blogger.com/profile/13609779138164842374' rel='author'>View my complete profile</a>
<div class='clear'></div>
</div>
</div><div class='widget PageList' data-version='1' id='PageList1'>
<h2>Quick Links</h2>
<div class='widget-content'>
<ul>
<li>
<a href='http://blog.dscpl.com.au/p/decorators-and-monkey-patching.html'>Decorators and monkey patching.</a>
</li>
<li>
<a href='http://blog.dscpl.com.au/p/using-python-with-docker.html'>Using Python with Docker.</a>
</li>
</ul>
<div class='clear'></div>
</div>
</div><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<select id='BlogArchive1_ArchiveMenu'>
<option value=''>Blog Archive</option>
<option value='http://blog.dscpl.com.au/2019/01/'>January (3)</option>
<option value='http://blog.dscpl.com.au/2018/12/'>December (4)</option>
<option value='http://blog.dscpl.com.au/2018/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2018/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2018/01/'>January (1)</option>
<option value='http://blog.dscpl.com.au/2017/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2016/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2016/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2016/07/'>July (1)</option>
<option value='http://blog.dscpl.com.au/2016/04/'>April (2)</option>
<option value='http://blog.dscpl.com.au/2016/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2016/02/'>February (2)</option>
<option value='http://blog.dscpl.com.au/2016/01/'>January (3)</option>
<option value='http://blog.dscpl.com.au/2015/12/'>December (6)</option>
<option value='http://blog.dscpl.com.au/2015/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2015/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2015/07/'>July (2)</option>
<option value='http://blog.dscpl.com.au/2015/06/'>June (5)</option>
<option value='http://blog.dscpl.com.au/2015/05/'>May (7)</option>
<option value='http://blog.dscpl.com.au/2015/04/'>April (4)</option>
<option value='http://blog.dscpl.com.au/2015/03/'>March (4)</option>
<option value='http://blog.dscpl.com.au/2015/01/'>January (2)</option>
<option value='http://blog.dscpl.com.au/2014/12/'>December (4)</option>
<option value='http://blog.dscpl.com.au/2014/11/'>November (1)</option>
<option value='http://blog.dscpl.com.au/2014/09/'>September (7)</option>
<option value='http://blog.dscpl.com.au/2014/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2014/05/'>May (1)</option>
<option value='http://blog.dscpl.com.au/2014/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2014/02/'>February (4)</option>
<option value='http://blog.dscpl.com.au/2014/01/'>January (8)</option>
<option value='http://blog.dscpl.com.au/2013/12/'>December (1)</option>
<option value='http://blog.dscpl.com.au/2012/12/'>December (1)</option>
<option value='http://blog.dscpl.com.au/2012/10/'>October (4)</option>
<option value='http://blog.dscpl.com.au/2012/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2011/11/'>November (1)</option>
<option value='http://blog.dscpl.com.au/2011/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2011/09/'>September (1)</option>
<option value='http://blog.dscpl.com.au/2011/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2011/01/'>January (5)</option>
<option value='http://blog.dscpl.com.au/2010/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2010/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2010/08/'>August (2)</option>
<option value='http://blog.dscpl.com.au/2010/06/'>June (2)</option>
<option value='http://blog.dscpl.com.au/2010/05/'>May (2)</option>
<option value='http://blog.dscpl.com.au/2010/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2010/03/'>March (3)</option>
<option value='http://blog.dscpl.com.au/2009/11/'>November (4)</option>
<option value='http://blog.dscpl.com.au/2009/10/'>October (3)</option>
<option value='http://blog.dscpl.com.au/2009/09/'>September (1)</option>
<option value='http://blog.dscpl.com.au/2009/08/'>August (3)</option>
<option value='http://blog.dscpl.com.au/2009/05/'>May (2)</option>
<option value='http://blog.dscpl.com.au/2009/04/'>April (5)</option>
<option value='http://blog.dscpl.com.au/2009/03/'>March (5)</option>
<option value='http://blog.dscpl.com.au/2009/02/'>February (1)</option>
<option value='http://blog.dscpl.com.au/2008/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2008/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2008/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2007/11/'>November (2)</option>
<option value='http://blog.dscpl.com.au/2007/10/'>October (3)</option>
<option value='http://blog.dscpl.com.au/2007/09/'>September (3)</option>
<option value='http://blog.dscpl.com.au/2007/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2007/07/'>July (2)</option>
<option value='http://blog.dscpl.com.au/2007/03/'>March (2)</option>
</select>
</div>
</div>
<div class='clear'></div>
</div>
</div><div class='widget Label' data-version='1' id='Label1'>
<h2>Labels</h2>
<div class='widget-content list-label-widget-content'>
<ul>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/python'>python</a>
<span dir='ltr'>(111)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/mod_wsgi'>mod_wsgi</a>
<span dir='ltr'>(86)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/wsgi'>wsgi</a>
<span dir='ltr'>(58)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/apache'>apache</a>
<span dir='ltr'>(35)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/docker'>docker</a>
<span dir='ltr'>(34)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/openshift'>openshift</a>
<span dir='ltr'>(26)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/decorators'>decorators</a>
<span dir='ltr'>(15)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/django'>django</a>
<span dir='ltr'>(13)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/kubernetes'>kubernetes</a>
<span dir='ltr'>(12)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/mod_python'>mod_python</a>
<span dir='ltr'>(9)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/red%20hat'>red hat</a>
<span dir='ltr'>(9)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/ipython'>ipython</a>
<span dir='ltr'>(7)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/jupyterhub'>jupyterhub</a>
<span dir='ltr'>(7)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/new%20relic'>new relic</a>
<span dir='ltr'>(6)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/wrapt'>wrapt</a>
<span dir='ltr'>(6)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/pycon'>pycon</a>
<span dir='ltr'>(5)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/s2i'>s2i</a>
<span dir='ltr'>(4)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/gunicorn'>gunicorn</a>
<span dir='ltr'>(3)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/uWSGI'>uWSGI</a>
<span dir='ltr'>(3)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/datadog'>datadog</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/nginx'>nginx</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/statsd'>statsd</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/web2py'>web2py</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/async'>async</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/dyndns53'>dyndns53</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/fastcgi'>fastcgi</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/heroku'>heroku</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/jupyter'>jupyter</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/lektor'>lektor</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/php'>php</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/shiv'>shiv</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/testing'>testing</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/tornado'>tornado</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/warpdrive'>warpdrive</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/zipapp'>zipapp</a>
<span dir='ltr'>(1)</span>
</li>
</ul>
<div class='clear'></div>
</div>
</div></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot section' id='footer-1'><div class='widget AdSense' data-version='1' id='AdSense1'>
<div class='widget-content'>
<script type="text/javascript"><!--
google_ad_client="pub-6433235630058377";
google_ad_host="pub-1556223355139109";
google_ad_width=120;
google_ad_height=600;
google_ad_format="120x600_as";
google_ad_type="text";
google_ad_host_channel="0001";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="999999";
google_color_url="5588AA";
google_color_text="666666";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class='clear'></div>
</div>
</div></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot no-items section' id='footer-2-1'></div>
</td>
<td class='columns-cell'>
<div class='foot no-items section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Simple theme. Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/552934507-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY6dIKlWB6J4nLLhdxQkuSMRCnwPAw:1757388545298';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d2363643920942057324','//blog.dscpl.com.au/2014/01/implementing-universal-decorator.html','2363643920942057324');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '2363643920942057324', 'title': 'Graham Dumpleton', 'url': 'http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html', 'canonicalUrl': 'http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html', 'homepageUrl': 'http://blog.dscpl.com.au/', 'searchUrl': 'http://blog.dscpl.com.au/search', 'canonicalHomepageUrl': 'http://blog.dscpl.com.au/', 'blogspotFaviconUrl': 'http://blog.dscpl.com.au/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': true, 'httpsEnabled': false, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Graham Dumpleton - RSS\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/2363643920942057324/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/7588699231967083693/comments/default\x22 /\x3e\n', 'meTag': '', 'adsenseClientId': 'ca-pub-6433235630058377', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': true, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/b4594f574ba3c273', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'X', 'key': 'twitter', 'shareMessage': 'Share to X', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '7588699231967083693', 'pageName': 'Implementing a universal decorator.', 'pageTitle': 'Graham Dumpleton: Implementing a universal decorator.'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'Simple', 'localizedName': 'Simple', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false, 'variant': 'pale', 'variantId': 'pale'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Implementing a universal decorator.', 'description': ' This is the fourth post in my series of blog posts about Python decorators and how I believe they are generally poorly implemented. It foll...', 'url': 'http://blog.dscpl.com.au/2014/01/implementing-universal-decorator.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 7588699231967083693}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/3842676126-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/828616780-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_ProfileView', new _WidgetInfo('Profile1', 'sidebar-right-1', document.getElementById('Profile1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'sidebar-right-1', document.getElementById('PageList1'), {'title': 'Quick Links', 'links': [{'isCurrentPage': false, 'href': 'http://blog.dscpl.com.au/p/decorators-and-monkey-patching.html', 'id': '3350721465154129789', 'title': 'Decorators and monkey patching.'}, {'isCurrentPage': false, 'href': 'http://blog.dscpl.com.au/p/using-python-with-docker.html', 'id': '5591286857776935907', 'title': 'Using Python with Docker.'}], 'mobile': false, 'showPlaceholder': true, 'hasCurrentPage': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LabelView', new _WidgetInfo('Label1', 'sidebar-right-1', document.getElementById('Label1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AdSenseView', new _WidgetInfo('AdSense1', 'footer-1', document.getElementById('AdSense1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>