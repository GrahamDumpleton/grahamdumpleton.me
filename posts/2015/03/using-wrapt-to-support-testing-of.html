<!DOCTYPE html>
<html class='v2' dir='ltr' lang='en'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/2508126174-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='http://blog.dscpl.com.au/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='http://blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Graham Dumpleton - Atom" href="http://blog.dscpl.com.au/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Graham Dumpleton - RSS" href="http://blog.dscpl.com.au/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Graham Dumpleton - Atom" href="https://www.blogger.com/feeds/2363643920942057324/posts/default" />

<link rel="alternate" type="application/atom+xml" title="Graham Dumpleton - Atom" href="http://blog.dscpl.com.au/feeds/3174978698827025881/comments/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<meta content='http://blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html' property='og:url'/>
<meta content='Using wrapt to support testing of software.' property='og:title'/>
<meta content='When talking about unit testing in Python, one of the more popular packages used to assist in that task is the Mock  package. I will no doub...' property='og:description'/>
<title>Graham Dumpleton: Using wrapt to support testing of software.</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */
/* Content
----------------------------------------------- */
body {
font: normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #222222;
background: #66bbdd none repeat scroll top left;
padding: 0 40px 40px 40px;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2187bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #32aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 40px rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 5px rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 10px #333333;
box-shadow: 0 0 40px rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 10px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #3299bb;
text-shadow: -1px -1px 1px rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #3299bb;
}
.Header .description {
font-size: 140%;
color: #777777;
}
.header-inner .Header .titlewrapper {
padding: 22px 30px;
}
.header-inner .Header .descriptionwrapper {
padding: 0 30px;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 1px solid #eeeeee;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #eeeeee;
border-left: 0 solid #eeeeee;
border-right: 0 solid #eeeeee;
}
.tabs-inner .widget ul {
background: #f5f5f5 url(https://resources.blogblog.com/blogblog/data/1kt/simple/gradients_light.png) repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #eeeeee;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #999999;
border-left: 1px solid #ffffff;
border-right: 1px solid #eeeeee;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid #eeeeee;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid #eeeeee;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid #eeeeee;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: transparent;
color: #222222;
padding: inherit;
letter-spacing: inherit;
margin: inherit;
}
.main-inner {
padding-top: 30px;
padding-bottom: 30px;
}
.main-inner .column-center-inner {
padding: 0 15px;
}
.main-inner .column-center-inner .section {
margin: 0 15px;
}
.post {
margin: 0 0 25px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #222222;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #f9f9f9;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid #eeeeee;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #eeeeee;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #f9f9f9;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid #eeeeee;
}
.blog-pager {
background: transparent none no-repeat scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 0 dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #222222;
}
.mobile-link-button {
background-color: #2187bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #eeeeee;
border-bottom: 1px solid #eeeeee;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #eeeeee;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1020px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1020px;
max-width: 1020px;
_width: 1020px;
}
.main-inner .columns {
padding-left: 0px;
padding-right: 200px;
}
.main-inner .fauxcolumn-center-outer {
left: 0px;
right: 200px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0px") -
parseInt("200px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0px;
}
.main-inner .fauxcolumn-right-outer {
width: 200px;
}
.main-inner .column-left-outer {
width: 0px;
right: 100%;
margin-left: -0px;
}
.main-inner .column-right-outer {
width: 200px;
margin-right: -200px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2363643920942057324&amp;zx=8e425bf4-e933-49a5-a874-6a5d9cccad39' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2363643920942057324&amp;zx=8e425bf4-e933-49a5-a874-6a5d9cccad39' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

<!-- data-ad-client=ca-pub-6433235630058377 -->

</head>
<body class='loading variant-pale'>
<div class='navbar section' id='navbar' name='Navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar/2363643920942057324?po\x3d3174978698827025881\x26origin\x3dhttp://blog.dscpl.com.au',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='http://blog.dscpl.com.au/'>
Graham Dumpleton
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>
</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol' name='Cross-Column'></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Thursday, March 12, 2015</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='2363643920942057324' itemprop='blogId'/>
<meta content='3174978698827025881' itemprop='postId'/>
<a name='3174978698827025881'></a>
<h3 class='post-title entry-title' itemprop='name'>
Using wrapt to support testing of software.
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-3174978698827025881' itemprop='description articleBody'>
<p>When talking about unit testing in Python, one of the more popular packages used to assist in that task is the <a href="https://pypi.python.org/pypi/mock">Mock</a> package. I will no doubt be labelled as a heretic but when I have tried to use it for things it just doesn't seem to sit right with my way of thinking.</p>
<p>It may also just be that what I am trying to apply it to isn't a good fit. In what I want to test it usually isn't so much that I want to mock out lower layers, but more that I simply want to validate data being passed through to the next layer or otherwise modify results. In other words I usually still need the system as a whole to function end to end and possibly over an extended time.</p>
<p>So for the more complex testing I need to do I actually keep falling back on the monkey patching capabilities of wrapt. It may well just be that since I wrote wrapt that I am more familiar with its paradigm, or that I prefer the more explicit way that wrapt requires you to do things. Either way, for me at least wrapt helps me to get the job done quicker.</p>
<p>To explain a bit more about the monkey patching capabilities of wrapt, I am in this blog post going to show how some of the things you can do in Mock you can do with wrapt. Just keep in mind that I am an absolute novice when it comes to Mock and so&#160;I could also just be too dumb to understand how to use it properly for what I want to do easily.</p>
<h1>Return values and side effects</h1>
<p>If one is using Mock and you want to temporarily override the value returned by a method of a class when called, one way is to use:</p>
<blockquote>
<pre>from mock import Mock, patch</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; print a, b, c, key</pre>
<pre>@patch(__name__+'.ProductionClass.method', return_value=3)<br />def test_method(mock_method):<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; result = real.method(3, 4, 5, key='value')<br />&#160; &#160; mock_method.assert_called_with(3, 4, 5, key='value')<br />&#160; &#160; assert result == 3</pre>
</blockquote>
<p>With what I have presented so far of the wrapt package, an equivalent way of doing this would be:</p>
<blockquote>
<pre>from wrapt import patch_function_wrapper</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; print a, b, c, key</pre>
<pre>@patch_function_wrapper(__name__, 'ProductionClass.method')<br />def wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; assert args == (3, 4, 5) and kwargs.get('key') == 'value'<br />&#160; &#160; return 3</pre>
<pre>def test_method():<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; result = real.method(3, 4, 5, key='value')<br />&#160; &#160; assert result == 3</pre>
</blockquote>
<p>An issue with this though is that the 'wrapt.patch_function_wrapper()' function I previously described applies a permanent patch. This is okay where it does need to survive for the life of the process, but in the case of testing we usually want to only have a patch apply to the single unit test function being run at that time. So the patch should be removed at the end of that test and before the next function is called.</p>
<p>For that scenario, the wrapt package provides an alternate decorator '@wrapt.transient_function_wrapper'. &#160;This can be used to create a wrapper function that will only be applied for the scope of a specific call that the decorated function is applied to. We can therefore write the above as:</p>
<blockquote>
<pre>from wrapt import transient_function_wrapper</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; print a, b, c, key</pre>
<pre>@transient_function_wrapper(__name__, 'ProductionClass.method')<br />def apply_ProductionClass_method_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; assert args == (3, 4, 5) and kwargs.get('key') == 'value'<br />&#160; &#160; return 3</pre>
<pre>@apply_ProductionClass_method_wrapper<br />def test_method():<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; result = real.method(3, 4, 5, key='value')<br />&#160; &#160; assert result == 3</pre>
</blockquote>
<p>Although this example shows how to return a substitute for the method being called, the more typical case is that I still want to call the original wrapped function. Thus, perhaps validating the arguments being passed in or the return value being passed back from the lower layers.</p>
<p>For this blog post when I tried to work out how to do that with Mock the general approach I came up with was the following.</p>
<blockquote>
<pre>from mock import Mock, patch</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160;     print a, b, c, key</pre>
<pre>def wrapper(wrapped):<br />&#160; &#160; def _wrapper(self, *args, **kwargs):<br />        assert args == (3, 4, 5) and kwargs.get('key') == 'value'<br />&#160; &#160; &#160; &#160; return wrapped(self, *args, **kwargs)<br />&#160; &#160; return _wrapper</pre>
<pre>@patch(__name__+'.ProductionClass.method', autospec=True,<br />&#160; &#160; &#160; &#160; side_effect=wrapper(ProductionClass.method))<br />def test_method(mock_method):<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; result = real.method(3, 4, 5, key='value')</pre>
</blockquote>
<p>There were two tricks here. The first is the 'autospec=True' argument to '@Mock.patch' to have it perform method binding, and the second being the need to capture the original method from the 'ProductionClass' before any mock had been applied to it, so I could then in turn call it when the side effect function for the mock was called.</p>
<p>No doubt someone will tell me that I am doing this all wrong and there is a simpler way, but that is the best I could come up with after 10 minutes of reading the Mock documentation.</p>
<p>When using wrapt to do the same thing, what is used is little different to what was used when mocking the return value. This is because the wrapt function wrappers will work with both normal functions or methods and so nothing special has to be done when wrapping methods. Further, when the wrapt wrapper function is called, it is always passed the original function which was wrapped, so no magic is needed to stash that away.</p>
<blockquote>
<pre>from wrapt import transient_function_wrapper</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; print a, b, c, key</pre>
<pre>@transient_function_wrapper(__name__, 'ProductionClass.method')<br />def apply_ProductionClass_method_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; assert args == (3, 4, 5) and kwargs.get('key') == 'value'<br />&#160; &#160; return wrapped(*args, **kwargs)</pre>
<pre>@apply_ProductionClass_method_wrapper<br />def test_method():<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; result = real.method(3, 4, 5, key='value')</pre>
</blockquote>
<p>Using this ability to easily intercept a call to perform validation of data being passed, but still call the original, I can relatively easily create a whole bunch of decorators for performing validation on data as is it is passed through different parts of the system. I can then stack up these decorators on any test function that I need to add them to.</p>
<h1>Wrapping of return values</h1>
<p>The above recipes cover being able to return a fake return value, returning the original, or some slight modification of the original where it is some primitive data type or collection. In some cases though I actually want to put a wrapper around the return value to modify how subsequent code interacts with it.&#160;</p>
<p>The first example of this is where the wrapped function returns another function which would then be called by something higher up the call chain. Here I may want to put a wrapper around the returned function to allow me to then intercept when it is called.</p>
<p>In the case of using Mock I would do something like:</p>
<blockquote>
<pre>from mock import Mock, patch</pre>
<pre>def function():<br />&#160; &#160; pass</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; return function</pre>
<pre>def wrapper2(wrapped):<br />&#160; &#160; def _wrapper2(*args, **kwargs):<br />&#160; &#160; &#160; &#160; return wrapped(*args, **kwargs)<br />&#160; &#160; return _wrapper2</pre>
<pre>def wrapper1(wrapped):<br />&#160; &#160; def _wrapper1(self, *args, **kwargs):<br />&#160; &#160; &#160; &#160; func = wrapped(self, *args, **kwargs)<br />&#160; &#160; &#160; &#160; return Mock(side_effect=wrapper2(func))<br />&#160; &#160; return _wrapper1</pre>
<pre>@patch(__name__+'.ProductionClass.method', autospec=True,<br />&#160; &#160; &#160; &#160; side_effect=wrapper1(ProductionClass.method))<br />def test_method(mock_method):<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; func = real.method(3, 4, 5, key='value')<br />&#160; &#160; result = func()</pre>
</blockquote>
<p>And with wrapt I would instead do:</p>
<blockquote>
<pre>from wrapt import transient_function_wrapper, function_wrapper</pre>
<pre>def function():<br />&#160; &#160; pass</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; return function</pre>
<pre>@function_wrapper<br />def result_function_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; return wrapped(*args, **kwargs)</pre>
<pre>@transient_function_wrapper(__name__, 'ProductionClass.method')<br />def apply_ProductionClass_method_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; return result_function_wrapper(wrapped(*args, **kwargs))</pre>
<pre>@apply_ProductionClass_method_wrapper<br />def test_method():<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; func = real.method(3, 4, 5, key='value')<br />&#160; &#160; result = func()</pre>
</blockquote>
<p>In this example I have used a new decorator called '@wrapt.function_wrapper'. I could also have used '@wrapt.decorator' in this example. The '@wrapt.function_wrapper' decorator is actually just a cut down version of '@wrapt.decorator', lacking some of the bells and whistles that one doesn't generally need when doing explicit monkey patching, but otherwise it can be used in the same way.</p>
<p>I can therefore apply a wrapper around a function returned as a result. I could could even apply the same principal where a function is being passed in as an argument to some other function.</p>
<p>A different scenario to a function being returned is where an instance of a class is returned. In this case I may want to apply a wrapper around a specific method of just that instance of the class.</p>
<p>With the Mock library it again comes down to using its 'Mock' class and having to apply it in different ways to achieve the result you want. I am going to step back from Mock now though and just focus on how one can do things using wrapt.</p>
<p>So, depending on the requirements there are a couple of ways one could do this with wrapt.</p>
<p>The first approach is to replace the method on the instance directly with a wrapper which encapsulates the original method.</p>
<blockquote>
<pre>from wrapt import transient_function_wrapper, function_wrapper</pre>
<pre>class StorageClass(object):<br />&#160; &#160; def run(self):<br />&#160; &#160; &#160; &#160; pass</pre>
<pre>storage = StorageClass()</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; return storage</pre>
<pre>@function_wrapper<br />def run_method_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; return wrapped(*args, **kwargs)</pre>
<pre>@transient_function_wrapper(__name__, 'ProductionClass.method')<br />def apply_ProductionClass_method_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; storage = wrapped(*args, **kwargs)<br />&#160; &#160; storage.run = run_method_wrapper(storage.run)<br />&#160; &#160; return storage</pre>
<pre>@apply_ProductionClass_method_wrapper<br />def test_method():<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; data = real.method(3, 4, 5, key='value')<br />&#160; &#160; result = data.run()</pre>
</blockquote>
<p>This will create the desired result but in this example actually turns out to be a bad way of doing it.</p>
<p>The problem in this case is that the object being returned is one which has a life time beyond the test. That is, we are modifying an object stored at global scope and which might be used for a different test. By simply replacing the method on the instance, we have made a permanent change.</p>
<p>This would be okay if it was a temporary instance of a class created on demand just for that one call, but not where it is persistent like in this case.</p>
<p>We can't therefore modify the instance itself, but need to wrap the instance in some other way to intercept the method call.</p>
<p>To do this we make use of what is called an object proxy. This is a special object type which we can create an instance of to wrap another object. When accessing the proxy object, any attempts to access attributes will actually return the attribute from the wrapped object. Similarly, calling a method on the proxy will call the method on the wrapped object.</p>
<p>Having a distinct proxy object though allows us to change the behaviour on the proxy object and so change how code interacts with the wrapped object. We can therefore avoid needing to change the original object itself.</p>
<p>For this example what we can therefore do is:</p>
<blockquote>
<pre>from wrapt import transient_function_wrapper, ObjectProxy</pre>
<pre>class StorageClass(object):<br />&#160; &#160; def run(self):<br />&#160; &#160; &#160; &#160; pass</pre>
<pre>storage = StorageClass()</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; return storage</pre>
<pre>class StorageClassProxy(ObjectProxy):<br />&#160; &#160; def run(self):<br />&#160; &#160; &#160; &#160; return self.__wrapped__.run()</pre>
<pre>@transient_function_wrapper(__name__, 'ProductionClass.method')<br />def apply_ProductionClass_method_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; storage = wrapped(*args, **kwargs)<br />&#160; &#160; return StorageClassProxy(storage)</pre>
<pre>@apply_ProductionClass_method_wrapper<br />def test_method():<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; data = real.method(3, 4, 5, key='value')<br />&#160; &#160; result = data.run()</pre>
</blockquote>
<p>That is, we define the 'run()' method on the proxy object to intercept the call of the same method on the original object. We can then proceed to return fake values, validate arguments or results, or modify them as necessary.</p>
<p>With the proxy we can even intercept access to an attribute of the original object by adding a property to the proxy object.</p>
<blockquote>
<pre>from wrapt import transient_function_wrapper, ObjectProxy</pre>
<pre>class StorageClass(object):<br />&#160; &#160; def __init__(self):<br />&#160; &#160; &#160; &#160; self.name = 'name'</pre>
<pre>storage = StorageClass()</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; return storage</pre>
<pre>class StorageClassProxy(ObjectProxy):<br />&#160; &#160; @property<br />&#160; &#160; def name(self):<br />&#160; &#160; &#160; &#160; return self.__wrapped__.name</pre>
<pre>@transient_function_wrapper(__name__, 'ProductionClass.method')<br />def apply_ProductionClass_method_wrapper(wrapped, instance, args, kwargs):<br />&#160; &#160; storage = wrapped(*args, **kwargs)<br />&#160; &#160; return StorageClassProxy(storage)</pre>
<pre>@apply_ProductionClass_method_wrapper<br />def test_method():<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; data = real.method(3, 4, 5, key='value')<br />&#160; &#160; assert data.name == 'name'</pre>
</blockquote>
<h1>Building a better Mock</h1>
<p>You might be saying at this point that Mock does a lot more than this. You might even want to point out how Mock can save away details about the call which can be checked later at the level of the test harness, rather than having to resort to raising assertion errors down in the wrappers themselves which can be an issue if code catches the exceptions before you see them.</p>
<p>This is all true, but the goal at this point for wrapt has been to provide monkey patching mechanisms which do respect introspection, the descriptor protocol and other things besides. That I can use it for the type of testing I do is a bonus.&#160;</p>
<p>You aren't limited to using just the basic building blocks themselves though and personally I think wrapt could be a great base on which to build a better Mock library for testing.</p>
<p>I therefore leave you with one final example to get you thinking about the ways this might be done if you are partial to the way that Mock does things.</p>
<blockquote>
<pre>from wrapt import transient_function_wrapper</pre>
<pre>class ProductionClass(object):<br />&#160; &#160; def method(self, a, b, c, key):<br />&#160; &#160; &#160; &#160; pass</pre>
<pre>def patch(module, name):<br />&#160; &#160; def _decorator(wrapped):<br />&#160; &#160; &#160; &#160; class Wrapper(object):<br />&#160; &#160; &#160; &#160; &#160; &#160; @transient_function_wrapper(module, name)<br />&#160; &#160; &#160; &#160; &#160; &#160; def __call__(self, wrapped, instance, args, kwargs):<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; self.args = args<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; self.kwargs = kwargs<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; return wrapped(*args, **kwargs)</pre>
<pre>&#160; &#160; &#160; &#160; wrapper = Wrapper()</pre>
<pre>&#160; &#160; &#160; &#160; @wrapper<br />&#160; &#160; &#160; &#160; def _wrapper():<br />&#160; &#160; &#160; &#160; &#160; &#160; return wrapped(wrapper)</pre>
<pre>&#160; &#160; &#160; &#160; return _wrapper</pre>
<pre>&#160; &#160; return _decorator</pre>
<pre>@patch(__name__, 'ProductionClass.method')<br />def test_method(mock_method):<br />&#160; &#160; real = ProductionClass()<br />&#160; &#160; result = real.method(3, 4, 5, key='value')<br />&#160; &#160; assert real.method.__name__ == 'method'<br />&#160; &#160; assert mock_method.args == (3, 4, 5)<br />&#160; &#160; assert mock_method.kwargs.get('key') == 'value'</pre>
</blockquote>
<p>So that is a quick run down of the main parts of the functionality provided by wrapt for doing monkey patching. There are a few others things, but that is in the main all you usually require. I use monkey patching for actually adding instrumentation into existing code to support performance monitoring, but I have shown here how the same techniques can be used in writing tests for your code as an alternative to a package like Mock.</p>
<p>As I mentioned in my <a href="http://blog.dscpl.com.au/2015/03/safely-applying-monkey-patches-in-python.html">previous post</a> though, one of the big problems with monkey patching is the order in which modules get imported relative to when the monkey patching is done. I will talk more about that issue in the next post.</p>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/13609779138164842374' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/13609779138164842374' rel='author' title='author profile'>
<span itemprop='name'>Graham Dumpleton</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html' itemprop='url'/>
<a class='timestamp-link' href='http://blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2015-03-12T17:50:00+11:00'>5:50&#8239;PM</abbr></a>
</span>
<span class='post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post/2363643920942057324/3174978698827025881' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3174978698827025881&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3174978698827025881&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3174978698827025881&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3174978698827025881&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=3174978698827025881&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='http://blog.dscpl.com.au/search/label/decorators' rel='tag'>decorators</a>,
<a href='http://blog.dscpl.com.au/search/label/python' rel='tag'>python</a>,
<a href='http://blog.dscpl.com.au/search/label/testing' rel='tag'>testing</a>,
<a href='http://blog.dscpl.com.au/search/label/wrapt' rel='tag'>wrapt</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>No comments:</h4>
<div id='Blog1_comments-block-wrapper'>
<dl class='avatar-comment-indent' id='comments-block'>
</dl>
</div>
<p class='comment-footer'>
<a href='https://www.blogger.com/comment/fullpage/post/2363643920942057324/3174978698827025881' onclick=''>Post a Comment</a>
</p>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='http://blog.dscpl.com.au/2015/03/ordering-issues-when-monkey-patching-in.html' id='Blog1_blog-pager-newer-link' title='Newer Post'>Newer Post</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='http://blog.dscpl.com.au/2015/03/safely-applying-monkey-patches-in-python.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='http://blog.dscpl.com.au/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='http://blog.dscpl.com.au/feeds/3174978698827025881/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget Profile' data-version='1' id='Profile1'>
<h2>About Me</h2>
<div class='widget-content'>
<dl class='profile-datablock'>
<dt class='profile-data'>
<a class='profile-name-link g-profile' href='https://www.blogger.com/profile/13609779138164842374' rel='author' style='background-image: url(//www.blogger.com/img/logo-16.png);'>
Graham Dumpleton
</a>
</dt>
</dl>
<a class='profile-link' href='https://www.blogger.com/profile/13609779138164842374' rel='author'>View my complete profile</a>
<div class='clear'></div>
</div>
</div><div class='widget PageList' data-version='1' id='PageList1'>
<h2>Quick Links</h2>
<div class='widget-content'>
<ul>
<li>
<a href='http://blog.dscpl.com.au/p/decorators-and-monkey-patching.html'>Decorators and monkey patching.</a>
</li>
<li>
<a href='http://blog.dscpl.com.au/p/using-python-with-docker.html'>Using Python with Docker.</a>
</li>
</ul>
<div class='clear'></div>
</div>
</div><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<select id='BlogArchive1_ArchiveMenu'>
<option value=''>Blog Archive</option>
<option value='http://blog.dscpl.com.au/2019/01/'>January (3)</option>
<option value='http://blog.dscpl.com.au/2018/12/'>December (4)</option>
<option value='http://blog.dscpl.com.au/2018/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2018/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2018/01/'>January (1)</option>
<option value='http://blog.dscpl.com.au/2017/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2016/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2016/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2016/07/'>July (1)</option>
<option value='http://blog.dscpl.com.au/2016/04/'>April (2)</option>
<option value='http://blog.dscpl.com.au/2016/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2016/02/'>February (2)</option>
<option value='http://blog.dscpl.com.au/2016/01/'>January (3)</option>
<option value='http://blog.dscpl.com.au/2015/12/'>December (6)</option>
<option value='http://blog.dscpl.com.au/2015/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2015/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2015/07/'>July (2)</option>
<option value='http://blog.dscpl.com.au/2015/06/'>June (5)</option>
<option value='http://blog.dscpl.com.au/2015/05/'>May (7)</option>
<option value='http://blog.dscpl.com.au/2015/04/'>April (4)</option>
<option value='http://blog.dscpl.com.au/2015/03/'>March (4)</option>
<option value='http://blog.dscpl.com.au/2015/01/'>January (2)</option>
<option value='http://blog.dscpl.com.au/2014/12/'>December (4)</option>
<option value='http://blog.dscpl.com.au/2014/11/'>November (1)</option>
<option value='http://blog.dscpl.com.au/2014/09/'>September (7)</option>
<option value='http://blog.dscpl.com.au/2014/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2014/05/'>May (1)</option>
<option value='http://blog.dscpl.com.au/2014/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2014/02/'>February (4)</option>
<option value='http://blog.dscpl.com.au/2014/01/'>January (8)</option>
<option value='http://blog.dscpl.com.au/2013/12/'>December (1)</option>
<option value='http://blog.dscpl.com.au/2012/12/'>December (1)</option>
<option value='http://blog.dscpl.com.au/2012/10/'>October (4)</option>
<option value='http://blog.dscpl.com.au/2012/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2011/11/'>November (1)</option>
<option value='http://blog.dscpl.com.au/2011/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2011/09/'>September (1)</option>
<option value='http://blog.dscpl.com.au/2011/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2011/01/'>January (5)</option>
<option value='http://blog.dscpl.com.au/2010/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2010/10/'>October (1)</option>
<option value='http://blog.dscpl.com.au/2010/08/'>August (2)</option>
<option value='http://blog.dscpl.com.au/2010/06/'>June (2)</option>
<option value='http://blog.dscpl.com.au/2010/05/'>May (2)</option>
<option value='http://blog.dscpl.com.au/2010/04/'>April (1)</option>
<option value='http://blog.dscpl.com.au/2010/03/'>March (3)</option>
<option value='http://blog.dscpl.com.au/2009/11/'>November (4)</option>
<option value='http://blog.dscpl.com.au/2009/10/'>October (3)</option>
<option value='http://blog.dscpl.com.au/2009/09/'>September (1)</option>
<option value='http://blog.dscpl.com.au/2009/08/'>August (3)</option>
<option value='http://blog.dscpl.com.au/2009/05/'>May (2)</option>
<option value='http://blog.dscpl.com.au/2009/04/'>April (5)</option>
<option value='http://blog.dscpl.com.au/2009/03/'>March (5)</option>
<option value='http://blog.dscpl.com.au/2009/02/'>February (1)</option>
<option value='http://blog.dscpl.com.au/2008/12/'>December (2)</option>
<option value='http://blog.dscpl.com.au/2008/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2008/03/'>March (1)</option>
<option value='http://blog.dscpl.com.au/2007/11/'>November (2)</option>
<option value='http://blog.dscpl.com.au/2007/10/'>October (3)</option>
<option value='http://blog.dscpl.com.au/2007/09/'>September (3)</option>
<option value='http://blog.dscpl.com.au/2007/08/'>August (1)</option>
<option value='http://blog.dscpl.com.au/2007/07/'>July (2)</option>
<option value='http://blog.dscpl.com.au/2007/03/'>March (2)</option>
</select>
</div>
</div>
<div class='clear'></div>
</div>
</div><div class='widget Label' data-version='1' id='Label1'>
<h2>Labels</h2>
<div class='widget-content list-label-widget-content'>
<ul>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/python'>python</a>
<span dir='ltr'>(111)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/mod_wsgi'>mod_wsgi</a>
<span dir='ltr'>(86)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/wsgi'>wsgi</a>
<span dir='ltr'>(58)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/apache'>apache</a>
<span dir='ltr'>(35)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/docker'>docker</a>
<span dir='ltr'>(34)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/openshift'>openshift</a>
<span dir='ltr'>(26)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/decorators'>decorators</a>
<span dir='ltr'>(15)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/django'>django</a>
<span dir='ltr'>(13)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/kubernetes'>kubernetes</a>
<span dir='ltr'>(12)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/mod_python'>mod_python</a>
<span dir='ltr'>(9)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/red%20hat'>red hat</a>
<span dir='ltr'>(9)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/ipython'>ipython</a>
<span dir='ltr'>(7)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/jupyterhub'>jupyterhub</a>
<span dir='ltr'>(7)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/new%20relic'>new relic</a>
<span dir='ltr'>(6)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/wrapt'>wrapt</a>
<span dir='ltr'>(6)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/pycon'>pycon</a>
<span dir='ltr'>(5)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/s2i'>s2i</a>
<span dir='ltr'>(4)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/gunicorn'>gunicorn</a>
<span dir='ltr'>(3)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/uWSGI'>uWSGI</a>
<span dir='ltr'>(3)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/datadog'>datadog</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/nginx'>nginx</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/statsd'>statsd</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/web2py'>web2py</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/async'>async</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/dyndns53'>dyndns53</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/fastcgi'>fastcgi</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/heroku'>heroku</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/jupyter'>jupyter</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/lektor'>lektor</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/php'>php</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/shiv'>shiv</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/testing'>testing</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/tornado'>tornado</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/warpdrive'>warpdrive</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='http://blog.dscpl.com.au/search/label/zipapp'>zipapp</a>
<span dir='ltr'>(1)</span>
</li>
</ul>
<div class='clear'></div>
</div>
</div></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot section' id='footer-1'><div class='widget AdSense' data-version='1' id='AdSense1'>
<div class='widget-content'>
<script type="text/javascript"><!--
google_ad_client="pub-6433235630058377";
google_ad_host="pub-1556223355139109";
google_ad_width=120;
google_ad_height=600;
google_ad_format="120x600_as";
google_ad_type="text";
google_ad_host_channel="0001";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="999999";
google_color_url="5588AA";
google_color_text="666666";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class='clear'></div>
</div>
</div></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot no-items section' id='footer-2-1'></div>
</td>
<td class='columns-cell'>
<div class='foot no-items section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Simple theme. Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/552934507-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY5BvEBdIyZknWn5vD1jePNnsPiPBQ:1757388574948';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d2363643920942057324','//blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html','2363643920942057324');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '2363643920942057324', 'title': 'Graham Dumpleton', 'url': 'http://blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html', 'canonicalUrl': 'http://blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html', 'homepageUrl': 'http://blog.dscpl.com.au/', 'searchUrl': 'http://blog.dscpl.com.au/search', 'canonicalHomepageUrl': 'http://blog.dscpl.com.au/', 'blogspotFaviconUrl': 'http://blog.dscpl.com.au/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': true, 'httpsEnabled': false, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Graham Dumpleton - RSS\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/2363643920942057324/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Graham Dumpleton - Atom\x22 href\x3d\x22http://blog.dscpl.com.au/feeds/3174978698827025881/comments/default\x22 /\x3e\n', 'meTag': '', 'adsenseClientId': 'ca-pub-6433235630058377', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': true, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/b4594f574ba3c273', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'X', 'key': 'twitter', 'shareMessage': 'Share to X', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '3174978698827025881', 'pageName': 'Using wrapt to support testing of software.', 'pageTitle': 'Graham Dumpleton: Using wrapt to support testing of software.'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'Simple', 'localizedName': 'Simple', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false, 'variant': 'pale', 'variantId': 'pale'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Using wrapt to support testing of software.', 'description': 'When talking about unit testing in Python, one of the more popular packages used to assist in that task is the Mock  package. I will no doub...', 'url': 'http://blog.dscpl.com.au/2015/03/using-wrapt-to-support-testing-of.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 3174978698827025881}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/3842676126-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/828616780-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_ProfileView', new _WidgetInfo('Profile1', 'sidebar-right-1', document.getElementById('Profile1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'sidebar-right-1', document.getElementById('PageList1'), {'title': 'Quick Links', 'links': [{'isCurrentPage': false, 'href': 'http://blog.dscpl.com.au/p/decorators-and-monkey-patching.html', 'id': '3350721465154129789', 'title': 'Decorators and monkey patching.'}, {'isCurrentPage': false, 'href': 'http://blog.dscpl.com.au/p/using-python-with-docker.html', 'id': '5591286857776935907', 'title': 'Using Python with Docker.'}], 'mobile': false, 'showPlaceholder': true, 'hasCurrentPage': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LabelView', new _WidgetInfo('Label1', 'sidebar-right-1', document.getElementById('Label1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AdSenseView', new _WidgetInfo('AdSense1', 'footer-1', document.getElementById('AdSense1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>